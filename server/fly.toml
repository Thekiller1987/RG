# fly.toml app configuration file generated by flyctl
#
# Configuración final y robusta para la VM siempre encendida (always-on).
#

app = "rg1"
primary_region = "gru"        # Usamos GRU (São Paulo) para evitar el bloqueo de SCL

[build]
  # Se omite la línea 'builder' para forzar el uso de tu Dockerfile
  
[http_service]
  internal_port = 8080        # Puerto que escucha tu server.js (process.env.PORT || 8080)
  force_https = true
  auto_stop_machines = false  # IMPORTANTE: Desactivamos el auto-apagado
  auto_start_machines = true
  min_machines_running = 1    # Mantiene una máquina activa para eliminar la latencia de inicio
  processes = ["app"]

[processes]
  app = "node server.js"      # FORZAMOS el comando de inicio para evitar errores de VM