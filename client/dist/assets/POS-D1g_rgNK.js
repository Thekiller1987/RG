import{r as l,j as e,Z as Et,$ as It,ax as Ft,a0 as Rt,a1 as Ot,I as Mt,A as St,s as Ee,m as Pt,n as wt,u as $t,R as Nt,ay as Bt,az as Tt,aA as kt,aB as _t,K as ct,x as Ze,aC as Wt,aD as Vt,af as et,aE as Lt,a3 as qt,aF as pt,aG as Gt,aH as Ht,a8 as Jt,aI as Qt,C as Je,q as Ut,aJ as Yt,aK as Kt,aL as Xt,i as Ke,aM as Zt,V as ea,aa as ta,X as aa,aN as oa,aO as na,H as ra,W as mt,aP as xt,aQ as He,aR as ft,ac as ia,ah as sa,a4 as la}from"./vendor-DfgwALhZ.js";import{M as zt,S as te,P as da,a as ca,b as pa,c as De,d as Oe,B as N,T as de,I as ut,e as gt,H as ma,f as xa,g as fa,C as ua,h as ga,i as ha,R as Pe,Q as ba,j as ht}from"./POS.styles-mxseP0n6.js";import{u as tt,a as ja,m as ya,p as Ca,q as bt,r as jt,t as va,v as Sa,n as wa,w as Xe,x as Na}from"./index-DIhA_mRk.js";import{S as Ta,T as ka}from"./SalesHistoryModal-CaLWhA2z.js";import"./AlertModal-DnqPm_iy.js";import{C as za}from"./ConfirmationModal-Divp1PE6.js";import"./scanner-vendor-DfxRpMWJ.js";import"./pdf-vendor-CTN92j8O.js";const yt=n=>Number(n||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),Ct=Ee.button`
  display: flex; align-items: center; justify-content: center;
  width: 42px; height: 42px;
  border: 1px solid ${n=>n.$active?"#3b82f6":"#cbd5e1"};
  background-color: ${n=>n.$active?"#eff6ff":"#fff"};
  color: ${n=>n.$active?"#3b82f6":"#64748b"};
  border-radius: 8px; cursor: pointer; transition: all 0.2s;

  &:hover { border-color: #3b82f6; color: #3b82f6; }
`,Aa=({isOpen:n,imageSrc:T,onClose:r})=>!n||!T?null:e.jsx(De,{onClick:r,children:e.jsxs(Pt.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:B=>B.stopPropagation(),style:{position:"relative",maxWidth:"95%",maxHeight:"90vh"},children:[e.jsx("button",{onClick:r,style:{position:"absolute",top:-15,right:-15,background:"white",width:32,height:32,borderRadius:"50%",border:"none",cursor:"pointer",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,color:"#ef4444"},children:e.jsx(wt,{})}),e.jsx("img",{src:T,alt:"Vista Ampliada",style:{maxWidth:"100%",maxHeight:"85vh",borderRadius:"12px",boxShadow:"0 20px 25px rgba(0,0,0,0.2)",background:"white",objectFit:"contain"}})]})});function Da({products:n=[],searchTerm:T,setSearchTerm:r,onProductClick:B,cartItems:M=[],reservedStock:q,inputRef:m,searchType:G="description",setSearchType:S=()=>{}}){const[w,$]=l.useState({isOpen:!1,imageUrl:null}),Q=l.useMemo(()=>{const c=new Map;for(const x of M){const C=x.id_producto||x.id;c.set(C,(c.get(C)||0)+Number(x.quantity||0))}return c},[M]),re=l.useMemo(()=>{const c=(T||"").toLowerCase().trim();return n.filter(C=>{const u=_=>_?String(_).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():"",W=u(c);if(!W)return!0;if(G==="code"){const _=u(C.codigo),h=u(C.codigo_barras);return _.startsWith(W)||h.startsWith(W)}else{const _=u(C.nombre),h=u(C.descripcion),V=u(C.codigo);return _.includes(W)||h.includes(W)||V.includes(W)}}).slice(0,100)},[n,T,G]),y=l.useMemo(()=>{const c=(T||"").toLowerCase().trim();return c?n.filter(x=>{const C=(x.nombre||"").toLowerCase(),u=String(x.codigo||"").toLowerCase();return C.includes(c)||u.includes(c)}).length:n.length},[n,T]);return e.jsxs(zt,{children:[e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"1rem",alignItems:"center"},children:[e.jsx(te,{ref:m,placeholder:G==="code"?"Escribe código...":"Buscar producto...",value:T,onChange:c=>r(c.target.value)}),e.jsx(Ct,{$active:G==="description",onClick:()=>{var c;S("description"),(c=m.current)==null||c.focus()},title:"Buscar por Nombre",children:e.jsx(Et,{size:16})}),e.jsx(Ct,{$active:G==="code",onClick:()=>{var c;S("code"),(c=m.current)==null||c.focus()},title:"Buscar por Código",children:e.jsx(It,{size:18})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",padding:"0 4px",fontSize:"0.85rem",color:"#64748b"},children:[e.jsxs("span",{children:[e.jsx(Ft,{color:"#3b82f6"})," ",re.length," mostrados"]}),e.jsxs("span",{children:["Total: ",y]})]}),e.jsx(da,{children:re.map(c=>{const x=c.id_producto||c.id,C=Q.get(x)||0,u=(q==null?void 0:q.get(x))||0,W=Math.max(0,Number(c.existencia||0)-C-u),_=W<=0;return e.jsxs(ca,{onClick:()=>!_&&B(c),outOfStock:_,title:c.nombre,children:[e.jsx(pa,{lowstock:W<5&&!_,outOfStock:_,children:_?"Agotado":`Stock: ${W}`}),e.jsxs("div",{className:"image-placeholder",style:{position:"relative",height:160,background:"#f8fafc",display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid #f1f5f9",overflow:"hidden"},children:[c.imagen&&e.jsx("div",{className:"eye-icon",onClick:h=>{h.stopPropagation(),$({isOpen:!0,imageUrl:c.imagen})},style:{position:"absolute",top:10,left:10,zIndex:20,background:"white",borderRadius:"50%",width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",cursor:"pointer",transition:"transform 0.2s"},title:"Ver imagen",children:e.jsx(Rt,{size:14,color:"#64748b"})}),c.imagen?e.jsx("img",{src:c.imagen,alt:c.nombre,loading:"lazy",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}):e.jsx(Ot,{className:"no-image-icon",size:40,color:"#e2e8f0"})]}),e.jsxs("div",{className:"info",style:{padding:"12px",flex:1,display:"flex",flexDirection:"column",gap:"4px"},children:[e.jsx("div",{className:"product-name",style:{fontWeight:600,fontSize:"0.88rem",color:"#1e293b",lineHeight:"1.25",height:"3.8rem",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:c.nombre}),e.jsx("div",{style:{fontSize:"0.85rem",fontWeight:"bold",color:"#334155",marginBottom:"4px"},children:c.codigo||"S/C"}),(Number(c.mayorista)>0||Number(c.mayoreo)>0)&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#10b981",display:"flex",alignItems:"center",gap:"4px",marginTop:"auto",marginBottom:"1px"},children:[e.jsx(Mt,{size:10})," May: C$ ",yt(c.mayorista||c.mayoreo)]}),e.jsxs("div",{className:"price",style:{fontWeight:800,color:"#2563eb",fontSize:"1.05rem",marginTop:Number(c.mayorista)>0||Number(c.mayoreo)>0?0:"auto"},children:["C$ ",yt(c.precio_venta||c.precio)]})]})]},x)})}),e.jsx(St,{children:w.isOpen&&e.jsx(Aa,{isOpen:!0,imageSrc:w.imageUrl,onClose:()=>$({isOpen:!1,imageUrl:null})})})]})}const Ea=Nt.memo(()=>e.jsx("style",{children:`
  /* Importar League Spartan */
  @import url('https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600;800;900&display=swap');

  @media print {
    body { visibility: hidden; margin: 0; padding: 0; }
    .print-area, .print-area * { visibility: visible !important; }
    .print-area {
      position: absolute !important; left: 0 !important; top: 0 !important;
      z-index: 999999 !important; margin: 0 !important; padding: 0 !important;
    }
    .no-print { display: none !important; }
    * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; box-shadow: none !important; text-shadow: none !important; }
  }
  `})),Ia=Ee.div`
  font-family: 'League Spartan', 'Consolas', sans-serif; color: #000; background: #fff;
  width: 310px; margin: 0 auto; padding: 12px 6px;
  box-shadow: 0 0 10px rgba(0,0,0,.08); border: 1px solid #eee; border-radius: 8px;

  /* Encabezado */
  .brand { text-align: center; border-bottom: 3px solid #000; padding-bottom: 12px; margin-bottom: 15px; }
  .brand img { max-width: 120px; display: block; margin: 0 auto 10px; }
  .brand h2 { margin: 0 0 6px; font-size: 1.6rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
  .brand p { margin: 3px 0; font-size: 1rem; font-weight: 700; }

  /* Secciones y Filas */
  .section { margin-bottom: 18px; border-bottom: 1px dashed #000; padding-bottom: 12px; }
  .section:last-child { border-bottom: none; }
  .section-title { font-weight: 900; text-align: center; text-transform: uppercase; font-size: 1.2rem; margin-bottom: 10px; text-decoration: underline; letter-spacing: 0.5px; }
  
  .row { display: flex; justify-content: space-between; font-size: 1.1rem; margin-bottom: 6px; align-items: baseline; font-weight: 600; }
  .row.big { font-size: 1.5rem; font-weight: 900; margin-top: 12px; border-top: 3px solid #000; padding-top: 8px; }
  .row.sub { font-size: 0.9rem; color: #333; font-style: italic; padding-left: 10px; margin-bottom: 4px; font-weight: 400; }
  .row.alert { background: #eee; padding: 8px; font-weight: 900; text-align: center; justify-content: center; gap: 10px; border: 2px solid #000; margin-top: 12px; font-size: 1.4rem; }

  /* Tablas simples */
  table { width: 100%; border-collapse: collapse; font-size: 1rem; margin-top: 8px; }
  th { border-bottom: 2px solid #000; text-align: left; font-weight: 900; padding: 4px 2px; }
  td { border-bottom: 1px dashed #ccc; padding: 4px 2px; }
  .text-right { text-align: right; }

  /* Firma */
  .signature { margin-top: 60px; text-align: center; page-break-inside: avoid; }
  .signature-line { border-top: 2px solid #000; width: 80%; margin: 0 auto 8px; }
  .signature p { font-size: 1.1rem; font-weight: 700; }

  @media print {
    &.print-80 {
      width: 80mm !important; 
      font-family: 'League Spartan', sans-serif !important; 
      padding: 0px !important; border: none !important; box-shadow: none !important;
    }
  }
`,Fa=(n,T)=>{var B,M;if(!n)return"N/A";if((B=n.pagoDetalles)!=null&&B.clienteNombre)return n.pagoDetalles.clienteNombre;const r=((M=n.pagoDetalles)==null?void 0:M.clienteId)||n.clientId;if(r&&(T==null?void 0:T.length)>0){const q=T.find(m=>String(m.id_cliente)===String(r));if(q)return q.nombre}return null},vt=({currentUser:n,isCajaOpen:T,session:r,onOpenCaja:B,onCloseCaja:M,onClose:q,isAdmin:m,showConfirmation:G,showAlert:S,initialTasaDolar:w,clients:$=[]})=>{var je,Ne;const[Q,re]=l.useState(""),[y,c]=l.useState(w||36.6),[x,C]=l.useState(""),[u,W]=l.useState(!1),_=$t(),h=(n==null?void 0:n.id_usuario)||(n==null?void 0:n.id);let V=(je=r==null?void 0:r.openedBy)==null?void 0:je.name;!V&&(r!=null&&r.openedBy)&&typeof r.openedBy=="string"&&(V=r.openedBy),V||(V=(r==null?void 0:r.userId)===h?(n==null?void 0:n.nombre_usuario)||(n==null?void 0:n.username):"Usuario"),V||(V="Caja General");const ae=m||(r==null?void 0:r.userId)===h||((Ne=r==null?void 0:r.openedBy)==null?void 0:Ne.id)===h,k=l.useMemo(()=>Array.isArray(r==null?void 0:r.transactions)?r.transactions:[],[r]),{cajaInicial:p,netCordobas:Se,netDolares:be,efectivoEsperado:ue,efectivoEsperadoCordobas:Te,efectivoEsperadoDolares:Ie,ventasContado:Qe,devoluciones:Ue,cancelaciones:Fe,entradas:z,salidas:A,abonos:Z,totalTarjeta:we,totalTransferencia:oe,totalCredito:fe,totalNoEfectivo:U,sumDevolucionesCancelaciones:pe,totalVentasDia:se,tasaRef:ee,totalHidden:me}=l.useMemo(()=>{const g=Number((r==null?void 0:r.initialAmount)||0),f=Number((r==null?void 0:r.tasaDolar)||w||36.6),Y={ventasContado:[],devoluciones:[],cancelaciones:[],entradas:[],salidas:[],abonos:[]};let P=0,ne=0,H=0,i=0,K=0,X=0,J=0,Re=0;for(const le of k){const O=((le==null?void 0:le.type)||"").toLowerCase();let I=(le==null?void 0:le.pagoDetalles)||{};if(typeof I=="string")try{I=JSON.parse(I)}catch{I={}}(!I||typeof I!="object")&&(I={});let Be=Number(I.ingresoCaja!==void 0?I.ingresoCaja:le.amount||0),ye=Number(I.totalVenta!==void 0?I.totalVenta:le.amount||0);(O==="salida"||O.includes("devolucion"))&&(Be=-Math.abs(Be),ye=-Math.abs(ye));const he=Be,Ce={...le,pagoDetalles:I,displayAmount:ye};if(O.includes("abono")){const Ve=Fa(Ce,$);Ve&&(Ce.resolvedClientName=Ve)}const _e=Number(I.tarjeta||0),We=Number(I.transferencia||0),Ge=Number(I.credito||0);O.startsWith("venta")||O.includes("abono")||O.includes("pedido")?(H+=_e,i+=We,K+=Ge):O==="ajuste"&&(I.target==="tarjeta"&&(H+=Number(le.amount||0)),I.target==="credito"&&(K+=Number(le.amount||0)),I.target==="transferencia"&&(i+=Number(le.amount||0))),O.startsWith("venta")||O==="venta_contado"||O==="venta_mixta"||O==="venta_credito"?I.efectivo!==void 0||I.dolares!==void 0?(P+=Number(I.efectivo||0)-Number(I.cambio||0),ne+=Number(I.dolares||0)):P+=he-_e-We-Ge:O.includes("abono")?I.dolares!==void 0?(ne+=Number(I.dolares||0),P+=Number(I.efectivo||0)):P+=he:O==="entrada"?P+=Math.abs(he):O==="salida"?P-=Math.abs(he):O.includes("devolucion")?P+=he:O==="ajuste"?(I.target==="efectivo"&&(P+=he,I.hidden&&(Re+=he)),I.target==="dolares"&&(ne+=he)):P+=he-_e-We,O.startsWith("venta")||O.includes("abono")||O==="entrada"?X+=Math.abs(ye):O.includes("devolucion")||O.includes("cancelacion")?X-=Math.abs(ye):O==="ajuste"&&(X+=ye),O.startsWith("venta")?Y.ventasContado.push(Ce):O.includes("devolucion")?(Y.devoluciones.push(Ce),J+=Math.abs(ye)):O.includes("cancelacion")?(Y.cancelaciones.push(Ce),J+=Math.abs(ye)):O==="entrada"?Y.entradas.push(Ce):O==="salida"?Y.salidas.push(Ce):O.includes("abono")&&Y.abonos.push(Ce)}const Me=g+P+ne*f;return{cajaInicial:g,netCordobas:P,netDolares:ne,efectivoEsperado:Me,efectivoEsperadoCordobas:g+P,efectivoEsperadoDolares:ne,ventasContado:Y.ventasContado,devoluciones:Y.devoluciones,cancelaciones:Y.cancelaciones,entradas:Y.entradas,salidas:Y.salidas,abonos:Y.abonos,totalTarjeta:H,totalTransferencia:i,totalCredito:K,totalNoEfectivo:H+i+K,sumDevolucionesCancelaciones:J,totalVentasDia:X,tasaRef:f,totalHidden:Re}},[k,r,w,$]),L=Number(x||0)-ue;r!=null&&r.openedAt&&new Date(r.openedAt);const ce=()=>{const g=parseFloat(Q||0);if(isNaN(g)||g<0)return S({title:"Inválido",message:"Monto inicial >= 0"});B(g,Number(y||36.6))},$e=()=>{if(isNaN(parseFloat(x)))return S({title:"Requerido",message:"Ingrese el monto contado físico."});W(!0)},ke=Nt.useCallback(()=>{const g=document.getElementById("print-wrapper-caja");if(!g)return;const f=g.outerHTML,Y=`
        @charset "UTF-8";
        @import url('https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600;800;900&display=swap');
        @page { size: 80mm auto; margin: 0; }
        html, body {
          background: #fff; margin: 0 !important; padding: 0 !important;
          -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;
          color: #000 !important; font-family: 'League Spartan', sans-serif !important;
        }
        #print-wrapper-caja, #print-wrapper-caja * {
          color: #000 !important; font-weight: 700 !important;
          text-shadow: none !important; box-shadow: none !important;
          visibility: visible !important;
        }
        #print-wrapper-caja {
          width: 80mm !important; padding: 0 !important; border: none !important;
        }
        .brand h2 { font-size: 20pt !important; letter-spacing: 2px !important; margin-bottom: 5px !important; }
        .section-title { font-size: 14pt !important; margin-bottom: 12px !important; border-bottom: 2px solid #000 !important; }
        .row { font-size: 12pt !important; margin-bottom: 6px !important; font-weight: 900 !important; }
        .row.big { font-size: 16pt !important; margin-top: 15px !important; border-top: 4px solid #000 !important; }
        .row.alert { font-size: 18pt !important; padding: 10px !important; border: 4px solid #000 !important; }
        .text-right { text-align: right !important; }
        
        @media print {
          * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
      `,P=window.open("","_blank","width=500,height=600");P&&(P.document.write(`<html><head><title>Cierre Caja</title><style>${Y}</style></head><body>${f}</body></html>`),P.document.close(),P.focus(),P.onload=function(){setTimeout(()=>{P.print()},300)},P.onafterprint=()=>{try{P.close()}catch{}})},[]),ge=()=>{ke(),setTimeout(()=>{M(Number(x))},800)},D=g=>`C$${Number(g||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,R=g=>`$${Number(g||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return e.jsxs(De,{className:"no-print",children:[e.jsx(Ea,{}),e.jsxs(Oe,{style:{maxWidth:u?450:760,padding:u?0:"1.5rem",background:"#f8f9fa"},children:[!u&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("h2",{style:{margin:0},children:"Gestión de Caja"}),e.jsx(N,{$cancel:!0,onClick:q,style:{borderRadius:"50%",width:32,height:32,padding:0},children:"✕"})]}),T?u?e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",maxHeight:"90vh"},children:[e.jsxs("div",{style:{padding:"15px 20px",background:"#343a40",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:"8px 8px 0 0"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",fontWeight:"800",letterSpacing:"0.5px"},children:"REPORTAR CIERRE DE CAJA"}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem",opacity:.8},children:new Date().toLocaleString("es-NI")})]}),e.jsxs(N,{$cancel:!0,onClick:()=>W(!1),style:{padding:"8px 15px",fontSize:"0.9rem",background:"rgba(255,255,255,0.2)",border:"none"},children:[e.jsx(Tt,{})," Volver / Editar"]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",background:"#f8f9fa",padding:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:15,marginBottom:20},children:[e.jsxs("div",{style:{background:"#fff",padding:15,borderRadius:8,boxShadow:"0 2px 5px rgba(0,0,0,0.05)",borderLeft:"4px solid #007bff"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#666",textTransform:"uppercase"},children:"Ventas Totales"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:"#333"},children:D(se)})]}),e.jsxs("div",{style:{background:"#fff",padding:15,borderRadius:8,boxShadow:"0 2px 5px rgba(0,0,0,0.05)",borderLeft:"4px solid #28a745"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#666",textTransform:"uppercase"},children:"Efectivo Real"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:"#28a745"},children:D(x)})]}),e.jsxs("div",{style:{background:"#fff",padding:15,borderRadius:8,boxShadow:"0 2px 5px rgba(0,0,0,0.05)",borderLeft:`4px solid ${L<0?"#dc3545":"#ffc107"}`},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#666",textTransform:"uppercase"},children:"Diferencia"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:L!==0?L<0?"#dc3545":"#e0a800":"#28a745"},children:[L>0?"+":"",D(L)]})]})]}),e.jsxs("div",{style:{background:"#fff",padding:20,borderRadius:8,boxShadow:"0 2px 10px rgba(0,0,0,0.05)",marginBottom:20},children:[e.jsx("h4",{style:{margin:"0 0 15px",borderBottom:"1px solid #eee",paddingBottom:10},children:"Arqueo Detallado"}),e.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #f1f1f1"},children:[e.jsx("td",{style:{padding:10},children:"Fondo Inicial"}),e.jsx("td",{className:"text-right",style:{padding:10,fontWeight:"bold"},children:D(p)})]}),e.jsx("tr",{style:{background:"#f8f9fa"},children:e.jsx("td",{colSpan:"2",style:{padding:"8px 10px",fontSize:"0.85rem",fontWeight:"bold",color:"#007bff"},children:"RESUMEN DE INGRESOS"})}),e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"4px 10px 4px 20px",fontSize:"0.9rem"},children:"(+) Ventas Netas (Ventas + Abonos - Devoluciones)"}),e.jsx("td",{className:"text-right",style:{padding:"4px 10px",fontSize:"0.9rem"},children:D(se)})]}),pe>0&&e.jsxs("tr",{children:[e.jsxs("td",{style:{padding:"4px 10px 4px 20px",fontSize:"0.85rem",color:"#856404"},children:["    (Devoluciones/Cancel. ya descontadas: ",D(pe),")"]}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"4px 10px 4px 20px",fontSize:"0.9rem",color:"#dc3545"},children:"(-) Tarjetas / Transf / Crédito"}),e.jsxs("td",{className:"text-right",style:{padding:"4px 10px",fontSize:"0.9rem",color:"#dc3545"},children:["- ",D(U)]})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"4px 10px 4px 20px",fontSize:"0.9rem",color:"#dc3545"},children:"(-) Salidas de Efectivo"}),e.jsxs("td",{className:"text-right",style:{padding:"4px 10px",fontSize:"0.9rem",color:"#dc3545"},children:["- ",D(A.reduce((g,f)=>g+Math.abs(f.displayAmount||0),0))]})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #f1f1f1",background:"#e8f5e9"},children:[e.jsx("td",{style:{padding:10,fontWeight:"bold",fontSize:"1.1rem"},children:"Esperado en Caja"}),e.jsx("td",{className:"text-right",style:{padding:10,fontWeight:"bold",fontSize:"1.1rem",color:"#146c43"},children:D(ue)})]})]})})]}),(Z.length>0||A.length>0)&&e.jsxs("div",{style:{background:"#fff",padding:20,borderRadius:8,boxShadow:"0 2px 10px rgba(0,0,0,0.05)"},children:[e.jsx("h4",{style:{margin:"0 0 15px",borderBottom:"1px solid #eee",paddingBottom:10},children:"Detalle de Movimientos"}),Z.length>0&&e.jsxs("div",{style:{marginBottom:15},children:[e.jsx("h5",{style:{color:"#007bff",margin:"0 0 5px"},children:"Abonos Recibidos"}),Z.map((g,f)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed #eee"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:g.resolvedClientName||"Cliente General"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:g.note||"Abono de cuenta"})]}),e.jsxs("div",{style:{fontWeight:"bold",color:"#28a745"},children:["+ ",D(g.amount)]})]},f))]}),A.length>0&&e.jsxs("div",{children:[e.jsx("h5",{style:{color:"#dc3545",margin:"0 0 5px"},children:"Salidas de Caja"}),A.map((g,f)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed #eee"},children:[e.jsx("div",{children:g.note||"Salida Varia"}),e.jsx("div",{style:{fontWeight:"bold",color:"#dc3545"},children:D(Math.abs(g.amount))})]},f))]})]})]}),e.jsx("div",{style:{display:"none"},children:e.jsxs(Ia,{id:"print-wrapper-caja",className:"print-80",children:[e.jsxs("div",{className:"brand",children:[e.jsx("img",{src:"/icons/logo.png",alt:"Logo",style:{filter:"grayscale(100%) contrast(150%)"}}),e.jsx("h2",{children:"CIERRE DE CAJA"}),e.jsx("p",{children:"Multirepuestos RG"}),e.jsx("p",{children:new Date().toLocaleString("es-NI")}),e.jsxs("p",{children:["Cajero: ",V]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"1. VENTAS NETAS"}),e.jsxs("div",{className:"row big",children:[e.jsx("span",{children:"TOTAL NETO:"}),e.jsx("span",{children:D(se)})]}),e.jsx("div",{className:"row sub",children:"(Ventas + Abonos - Devoluciones/Cancelaciones)"}),pe>0&&e.jsxs("div",{className:"row sub",style:{color:"#856404"},children:["(Devol./Cancel.: -",D(pe),")"]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"2. DESGLOSE NO EFECTIVO"}),we>0&&e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"(-) Tarjetas:"}),e.jsx("span",{children:D(we)})]}),oe>0&&e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"(-) Transf.:"}),e.jsx("span",{children:D(oe)})]}),fe>0&&e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"(-) Créditos:"}),e.jsx("span",{children:D(fe)})]}),e.jsxs("div",{className:"row",style:{borderTop:"1px dashed #000"},children:[e.jsx("span",{children:"TOTAL NO EFECTIVO:"}),e.jsx("span",{children:D(U)})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"3. FLUJO EFECTIVO (RESUMEN)"}),e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"Fondo Inicial:"}),e.jsx("span",{children:D(p)})]}),e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"(+) Ventas Netas:"}),e.jsx("span",{children:D(se)})]}),e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"(-) No Efectivo:"}),e.jsxs("span",{children:["-",D(U)]})]}),Math.abs(A.reduce((g,f)=>g+Math.abs(f.displayAmount||0),0))>0&&e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"(-) Salidas:"}),e.jsxs("span",{children:["-",D(A.reduce((g,f)=>g+Math.abs(f.displayAmount||0),0))]})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"4. ARQUEO FINAL"}),e.jsxs("div",{className:"row big",children:[e.jsx("span",{children:"EFECTIVO ESPERADO:"}),e.jsx("span",{children:D(ue)})]}),e.jsxs("div",{className:"row sub",children:["(",D(Te)," + ",R(Ie),")"]}),e.jsxs("div",{className:"row",style:{marginTop:8,paddingTop:4,borderTop:"1px dashed #ccc"},children:[e.jsx("span",{children:"EFECTIVO REAL:"}),e.jsx("span",{children:D(x)})]}),e.jsxs("div",{className:"row alert",style:{color:"#000",borderColor:"#000"},children:[e.jsx("span",{children:"DIFERENCIA:"}),e.jsxs("span",{children:[L>0?"+":"",D(L)]})]}),e.jsx("div",{style:{textAlign:"center",fontSize:"0.75rem",fontWeight:"bold",marginTop:2},children:Math.abs(L)<.5?"(CAJA CUADRADA)":L>0?"(SOBRANTE)":"(FALTANTE)"})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"5. DETALLE DE MOVIMIENTOS"}),e.jsx("table",{style:{marginTop:0},children:e.jsxs("tbody",{children:[Z.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{children:e.jsx("td",{colSpan:"2",style:{fontWeight:"900",background:"#f8f9fa",fontSize:"0.9rem"},children:"--- ABONOS Y CREDITOS ---"})}),Z.map((g,f)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{fontSize:"0.9rem"},children:[g.resolvedClientName||g.note||"Abono"," ",e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"#555"},children:["#",g.id]})]}),e.jsx("td",{className:"text-right",style:{fontSize:"0.9rem"},children:D(g.amount)})]},"a"+f))]}),A.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{children:e.jsx("td",{colSpan:"2",style:{fontWeight:"900",background:"#f8f9fa",fontSize:"0.9rem",paddingTop:8},children:"--- SALIDAS DE EFECTIVO ---"})}),A.map((g,f)=>e.jsxs("tr",{children:[e.jsx("td",{style:{fontSize:"0.9rem"},children:g.note||"Salida Varia"}),e.jsx("td",{className:"text-right",style:{fontSize:"0.9rem"},children:D(Math.abs(g.amount))})]},"s"+f))]}),z.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{children:e.jsx("td",{colSpan:"2",style:{fontWeight:"900",background:"#f8f9fa",fontSize:"0.9rem",paddingTop:8},children:"--- ENTRADAS DE EFECTIVO ---"})}),z.map((g,f)=>e.jsxs("tr",{children:[e.jsx("td",{style:{fontSize:"0.9rem"},children:g.note||"Entrada Varia"}),e.jsx("td",{className:"text-right",style:{fontSize:"0.9rem"},children:D(g.amount)})]},"e"+f))]})]})}),Z.length===0&&A.length===0&&z.length===0&&e.jsx("div",{style:{textAlign:"center",fontStyle:"italic",fontSize:"0.8rem",padding:5},children:"Sin movimientos extra"})]}),e.jsxs("div",{className:"signature",children:[e.jsx("div",{className:"signature-line"}),e.jsx("p",{children:"Firma Responsable"})]})]})}),e.jsxs("div",{style:{padding:"20px",background:"#fff",borderTop:"1px solid #ccc",display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx(N,{$cancel:!0,onClick:()=>W(!1),children:"Seguir Editando"}),e.jsxs(N,{primary:!0,style:{padding:"12px 24px",fontSize:"1rem",display:"flex",alignItems:"center",gap:8},onClick:ge,disabled:!ae,children:[e.jsx(kt,{})," IMPRIMIR Y CERRAR CAJA"]})]}),!ae&&e.jsx("div",{style:{padding:5,textAlign:"center",color:"red",fontSize:"0.8rem"},children:"Solo el Admin o quien abrió puede cerrar."})]}):e.jsxs("div",{children:[e.jsx("h3",{style:{color:"#dc3545",borderBottom:"2px solid #dc3545",paddingBottom:10},children:"Arqueo y Cierre"}),e.jsx("div",{style:{background:"#e9ecef",padding:10,borderRadius:6,marginBottom:15},children:e.jsxs(de,{style:{fontSize:"1.1rem"},children:[e.jsxs("span",{children:[e.jsx(_t,{})," Abrió:"]}),e.jsx("strong",{children:V})]})}),e.jsxs("div",{style:{marginTop:8,padding:"15px",backgroundColor:"#f8f9fa",borderRadius:6,border:"1px dashed #ced4da"},children:[e.jsx("div",{style:{fontWeight:"800",marginBottom:10,fontSize:"1.2rem",color:"#495057"},children:"Efectivo a Tener:"}),e.jsxs(de,{style:{fontSize:"1.3rem"},children:[e.jsx("span",{children:"Córdobas:"}),e.jsxs("strong",{style:{color:"#198754"},children:["C$ ",Number(Te).toLocaleString()]})]}),e.jsxs(de,{style:{fontSize:"1.3rem"},children:[e.jsx("span",{children:"Dólares:"}),e.jsxs("strong",{style:{color:"#198754"},children:["$ ",Number(Ie).toLocaleString()]})]}),e.jsxs(de,{$bold:!0,style:{marginTop:10,borderTop:"2px solid #ccc",paddingTop:10,fontSize:"1.5rem"},children:[e.jsx("span",{children:"TOTAL (C$):"}),e.jsx("span",{children:D(ue)})]})]}),e.jsx("label",{style:{display:"block",marginTop:20,fontWeight:800,fontSize:"1.3rem"},children:"Monto Contado Físico (C$)"}),e.jsx(te,{type:"number",step:"0.01",value:x,onChange:g=>C(g.target.value),autoFocus:!0,placeholder:"Total Billetes + Monedas",style:{fontSize:"1.5rem",padding:"12px",height:"auto"}}),x&&e.jsxs(de,{$bold:!0,style:{marginTop:15,color:L!==0?"#dc3545":"#28a745",fontSize:"1.8rem",padding:"10px",background:L!==0?"#fff5f5":"#f0fff4",borderRadius:8,border:`2px solid ${L!==0?"#dc3545":"#28a745"}`},children:[e.jsx("span",{children:"Diferencia:"}),e.jsx("span",{children:D(L)})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:20},children:[e.jsx(N,{primary:!0,style:{flex:1},onClick:$e,disabled:!ae||!x,children:"Ver Reporte"}),e.jsx(N,{$cancel:!0,onClick:q,children:"Cancelar"})]})]}):e.jsxs("div",{style:{padding:u?"1rem":0},children:[e.jsxs("h3",{style:{color:"#28a745",borderBottom:"2px solid #28a745",paddingBottom:10},children:[e.jsx(Bt,{})," Abrir Caja"]}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("label",{style:{fontWeight:600},children:"Monto Inicial (C$)"}),e.jsx(te,{type:"number",step:"0.01",value:Q,onChange:g=>re(g.target.value),autoFocus:!0}),e.jsx("label",{style:{fontWeight:600},children:"Tasa del Dólar"}),e.jsx(te,{type:"number",step:"0.01",value:y,onChange:g=>c(g.target.value)})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:10},children:[e.jsx(N,{primary:!0,style:{flex:1},onClick:ce,children:"Abrir Caja"}),e.jsx(N,{onClick:()=>_("/dashboard"),children:"Ir al Dashboard"})]})]})]})]})},Le=n=>{const T=parseFloat(n);return Number.isNaN(T)||Math.abs(T)<.001?0:T},Ra=({total:n=0,tasaDolar:T=1,onClose:r,onFinishSale:B,clientes:M=[],users:q=[],showAlert:m,initialClientId:G="0",cartSnapshot:S=[],currentUserId:w=void 0,orderSubtotal:$=void 0,orderDiscountAmount:Q=void 0})=>{const[re,y]=l.useState("0.00"),[c,x]=l.useState("0.00"),[C,u]=l.useState("0.00"),[W,_]=l.useState("0.00"),[h,V]=l.useState(""),[ae,k]=l.useState(""),[p,Se]=l.useState("contado"),[be,ue]=l.useState(G??"0"),[Te,Ie]=l.useState(!1),[Qe,Ue]=l.useState(!1),Fe=l.useMemo(()=>{const i=parseInt(be,10);return Number.isNaN(i)?0:i},[be]),z=Fe!==0,A=l.useMemo(()=>Le(re),[re]),Z=l.useMemo(()=>Le(c),[c]),we=l.useMemo(()=>Le(C),[C]),oe=l.useMemo(()=>Le(W),[W]),fe=l.useMemo(()=>we*Number(T||1),[we,T]),U=l.useMemo(()=>A+Z+oe+fe,[A,Z,oe,fe]),pe=l.useMemo(()=>Z>.01,[Z]),se=l.useMemo(()=>Number(n)-U,[n,U]),ee=l.useMemo(()=>p==="credito"&&z&&se>.01?se:(U>=Number(n)-1e-4,0),[p,z,se,U,n]),me=l.useMemo(()=>{const i=Le(se);return i<=.01||p==="credito"&&z?0:i},[se,p,z]),L=l.useMemo(()=>Math.max(0,-se),[se]),ce=l.useMemo(()=>ee>.01?U>.01?"mixto":"credito_total":"contado",[ee,U]),$e=l.useMemo(()=>{if(me>.01)return"PAGO INCOMPLETO";if((ce==="mixto"||ce==="credito_total")&&!z)return"CLIENTE NO SELECCIONADO";switch(ce){case"mixto":return"PAGO MIXTO (Contado + Crédito)";case"credito_total":return"CRÉDITO TOTAL";default:return"CONTADO"}},[ce,me,z]),ke=l.useMemo(()=>p==="credito"&&!z,[p,z]),ge=l.useMemo(()=>Te||me>.01||(ce==="mixto"||ce==="credito_total")&&!z||pe&&!h.trim()||oe>.01&&!ae.trim(),[Te,me,ce,z,pe,h,oe,ae]),D=l.useMemo(()=>Array.isArray(S)?S.map(({raw:i,costo:K,existencia:X,...J})=>({id:J.id||J.id_producto,nombre:J.nombre??J.descripcion??J.producto??"",quantity:Number(J.quantity||0),precio:Number(J.precio_venta??J.precio??0)})).filter(i=>i.quantity>0):[],[S]),R=l.useMemo(()=>typeof $=="number"?Number($):D.reduce((i,K)=>i+Number(K.precio||0)*Number(K.quantity||0),0),[$,D]);l.useMemo(()=>{if(typeof Q=="number")return Number(Q);const i=Number(R)-Number(n);return i>0?i:0},[Q,R,n]),l.useEffect(()=>{p==="contado"&&U===0&&Number(n)>0&&y(Number(n).toFixed(2)),p==="credito"&&!z&&ue("0")},[p,n]);const je=l.useCallback(i=>{const K=String(i.target.value);ue(K),(parseInt(K,10)||0)!==0&&(Se("contado"),U<Number(n)&&U===0&&y(Number(n).toFixed(2)))},[U,n]),Ne=l.useCallback(()=>{Se("contado");const i=Z+oe+fe,K=Math.max(0,Number(n)-i);y(Number(K).toFixed(2))},[Z,oe,fe,n]),g=l.useCallback(()=>{if(!z){m==null||m({title:"Cliente Requerido",message:"Debe seleccionar un cliente para habilitar la opción de Crédito.",type:"error"});return}Se("credito"),y("0.00"),x("0.00"),u("0.00"),_("0.00"),V(""),k("")},[z,m]),f=l.useCallback(()=>{y(Number(n).toFixed(2)),x("0.00"),u("0.00"),_("0.00"),V(""),k(""),Se("contado")},[n]),Y=({efectivo:i,tarjeta:K,transferencia:X,dolaresLocal:J,credito:Re})=>{const Me=i+K+X+J>.01;return Re&&Me?"mixto":Re&&!Me?"credito_total":"contado"},P=async i=>{if(!z||Fe===0){m==null||m({title:"Cliente Requerido",message:"No puedes vender sin seleccionar un cliente. Por favor selecciona uno.",type:"error"});return}if((ce==="credito_total"||ce==="mixto")&&Fe===0){m==null||m({title:"Cliente Requerido",message:"Debe seleccionar un cliente para ventas a crédito o mixtas.",type:"error"});return}if(me>.01){m==null||m({title:"Pago Incompleto",message:`Faltan C$${me.toFixed(2)} para completar la venta.`,type:"warning"});return}if(pe&&!h.trim()){m==null||m({title:"Dato Requerido",message:"Ingrese el número de referencia para el pago con tarjeta.",type:"warning"});return}if(oe>.01&&!ae.trim()){m==null||m({title:"Dato Requerido",message:"Ingrese el número de referencia para la transferencia.",type:"warning"});return}if(Te)return;Ie(!0);const K=Math.max(0,A+fe-L),X={totalVenta:Number(n),efectivo:A,tarjeta:Z,transferencia:oe,dolares:we,tasaDolarAlMomento:Number(T),referenciaTarjeta:h.trim(),referenciaTransferencia:ae.trim(),credito:ee,clienteId:Fe,tipoVenta:Y({efectivo:A,tarjeta:Z,transferencia:oe,dolaresLocal:fe,credito:p==="credito"}),cambio:Number(L),ingresoCaja:Number(K),shouldPrintNow:i};try{typeof B=="function"&&await B(X),r==null||r()}catch(J){m==null||m({title:"Error",message:(J==null?void 0:J.message)||"No se pudo completar la venta.",type:"error"})}finally{Ie(!1)}},ne=z?me>.01?"#dc3545":L>.01?"#28a745":"#17a2b8":"#dc3545",H=z?me>.01?`¡FALTA CUBRIR! C$${me.toFixed(2)}`:L>.01?`CAMBIO A ENTREGAR: C$${L.toFixed(2)}`:"BALANCE PERFECTO":"¡SELECCIONA UN CLIENTE!";return e.jsx(De,{children:e.jsxs(Oe,{style:{maxWidth:"950px",width:"96%",maxHeight:"90vh",overflow:"hidden",borderRadius:16,backgroundColor:"#f8f9fa",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"2px solid #e9ecef",paddingBottom:15,marginBottom:20},children:[e.jsxs("h2",{style:{margin:0,color:"#1e293b",fontSize:"1.5rem",fontWeight:800},children:[e.jsx(ct,{style:{marginRight:"0.5rem",color:"#007bff"}})," PROCESAR PAGO"]}),e.jsx(N,{$cancel:!0,onClick:r,style:{borderRadius:"50%",width:40,height:40,padding:0,fontSize:"1.2rem",backgroundColor:"#fee2e2",color:"#ef4444",borderColor:"transparent"},children:e.jsx(Ze,{})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5fr 4fr",gap:"2rem",height:"calc(90vh - 140px)"},children:[e.jsxs("div",{style:{paddingRight:10,borderRight:"1px solid #e2e8f0",overflowY:"auto",paddingBottom:10},children:[e.jsxs("div",{style:{padding:20,border:"1px solid #e2e8f0",borderRadius:12,backgroundColor:"#fff",marginBottom:20,boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsxs("h4",{style:{marginTop:0,color:"#334155",fontSize:"1rem",fontWeight:700,textTransform:"uppercase",marginBottom:15},children:[e.jsx(Wt,{style:{marginRight:6}})," Tipo de Venta"]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20},children:[e.jsx(N,{onClick:Ne,style:{flex:1,padding:"10px 0",backgroundColor:p==="contado"?"#0ea5e9":"#f1f5f9",color:p==="contado"?"#fff":"#475569",border:"none",borderRadius:8,fontWeight:"700",boxShadow:p==="contado"?"0 4px 6px -1px rgba(14, 165, 233, 0.4)":"none"},children:"CONTADO"}),e.jsx(N,{onClick:g,disabled:!z,style:{flex:1,padding:"10px 0",backgroundColor:p==="credito"?"#f59e0b":"#f1f5f9",color:p==="credito"?"#fff":"#475569",border:"none",borderRadius:8,fontWeight:"700",boxShadow:p==="credito"?"0 4px 6px -1px rgba(245, 158, 11, 0.4)":"none",opacity:z?1:.5},children:"CRÉDITO"})]}),e.jsxs("label",{style:{display:"block",fontWeight:"700",marginBottom:8,color:"#475569",fontSize:"0.9rem"},children:[e.jsx(Vt,{})," Seleccionar Cliente ",e.jsx("span",{style:{color:"#ef4444"},children:"* (Obligatorio)"})]}),e.jsxs(te,{as:"select",value:be,onChange:je,style:{height:42,padding:"0 12px",width:"100%",fontSize:"1rem",border:z?"2px solid #22c55e":"2px solid #ef4444",backgroundColor:z?"#f0fdf4":"#fef2f2",borderRadius:8},children:[e.jsx("option",{value:"0",children:"-- Seleccionar Cliente --"}),(M||[]).map(i=>e.jsxs("option",{value:i.id_cliente??i.id,children:[i.nombre,Number(i.saldo_pendiente||0)>0?` (Deuda: C$${Number(i.saldo_pendiente).toFixed(2)})`:""]},i.id_cliente??i.id))]}),!z&&e.jsxs("p",{style:{color:"#ef4444",margin:"8px 0 0",fontSize:"0.85rem",fontWeight:"600"},children:[e.jsx(Ze,{style:{marginRight:4}})," No puedes vender sin seleccionar un cliente."]})]}),e.jsxs("div",{style:{padding:20,border:"1px solid #e2e8f0",borderRadius:12,backgroundColor:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsx("h4",{style:{marginTop:0,color:"#334155",fontSize:"1rem",fontWeight:700,textTransform:"uppercase",borderBottom:"1px solid #f1f5f9",paddingBottom:10,marginBottom:15},children:"Desglose de Pago (C$)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontWeight:"600",fontSize:"0.85rem",marginBottom:6,color:"#64748b"},children:[e.jsx(et,{})," Efectivo"]}),e.jsx(te,{type:"number",step:"0.01",value:re,onChange:i=>y(i.target.value),style:{width:"100%",height:38,fontSize:"1rem",borderRadius:8,border:"1px solid #cbd5e1"},disabled:ke})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontWeight:"600",fontSize:"0.85rem",marginBottom:6,color:"#64748b"},children:[e.jsx(Lt,{})," Dólares"]}),e.jsx(te,{type:"number",step:"0.01",value:C,onChange:i=>u(i.target.value),style:{width:"100%",height:38,fontSize:"1rem",borderRadius:8,border:"1px solid #cbd5e1"},disabled:ke})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontWeight:"600",fontSize:"0.85rem",marginBottom:6,color:"#64748b"},children:[e.jsx(ct,{})," Tarjeta"]}),e.jsx(te,{type:"number",step:"0.01",value:c,onChange:i=>x(i.target.value),style:{width:"100%",height:38,fontSize:"1rem",borderRadius:8,border:"1px solid #cbd5e1"},disabled:ke})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontWeight:"600",fontSize:"0.85rem",marginBottom:6,color:"#64748b"},children:[e.jsx(Tt,{})," Transferencia"]}),e.jsx(te,{type:"number",step:"0.01",value:W,onChange:i=>_(i.target.value),style:{width:"100%",height:38,fontSize:"1rem",borderRadius:8,border:"1px solid #cbd5e1"},disabled:ke})]})]}),p==="credito"&&e.jsxs("div",{style:{marginTop:15,padding:12,backgroundColor:"#fff7ed",borderRadius:8,border:"1px dashed #f97316"},children:[e.jsxs("label",{style:{display:"block",fontWeight:"700",fontSize:"0.85rem",marginBottom:4,color:"#c2410c"},children:[e.jsx(qt,{})," CRÉDITO GENERADO"]}),e.jsxs("div",{style:{fontSize:"1.2rem",color:"#ea580c",fontWeight:800},children:["C$ ",ee.toFixed(2)]})]}),pe&&e.jsxs("div",{style:{marginTop:15,padding:12,border:"1px solid #fcd34d",borderRadius:8,backgroundColor:"#fffbeb"},children:[e.jsxs("label",{style:{display:"block",fontWeight:"700",fontSize:"0.85rem",color:"#b45309",marginBottom:6},children:[e.jsx(pt,{})," Nº Referencia Tarjeta ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx(te,{type:"text",placeholder:"Ej: 1234",value:h,onChange:i=>V(i.target.value),style:{width:"100%",height:36,fontSize:"0.95rem"}})]}),oe>.01&&e.jsxs("div",{style:{marginTop:15,padding:12,border:"1px solid #bae6fd",borderRadius:8,backgroundColor:"#f0f9ff"},children:[e.jsxs("label",{style:{display:"block",fontWeight:"700",fontSize:"0.85rem",color:"#0369a1",marginBottom:6},children:[e.jsx(pt,{})," Nº Referencia Transferencia ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx(te,{type:"text",placeholder:"Ej: REF-5678",value:ae,onChange:i=>k(i.target.value),style:{width:"100%",height:36,fontSize:"0.95rem"}})]}),p==="contado"&&e.jsxs(N,{info:!0,onClick:f,style:{width:"100%",padding:"12px 0",marginTop:20,backgroundColor:"#e0f2fe",color:"#0284c7",border:"1px dashed #0ea5e9",fontSize:"0.95rem",fontWeight:600},children:[e.jsx(Gt,{})," Rellenar con Efectivo (Total: C$ ",Number(n).toFixed(2),")"]})]})]}),e.jsxs("div",{style:{paddingLeft:10,display:"flex",flexDirection:"column",justifyContent:"space-between",paddingBottom:10},children:[e.jsxs("div",{children:[e.jsxs(ut,{style:{marginBottom:15,padding:20,backgroundColor:"#f0f9ff",border:"none",borderRadius:12,boxShadow:"inset 0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsxs(de,{$bold:!0,style:{fontSize:"1.8rem",color:"#0f172a",marginBottom:5},children:[e.jsx("span",{style:{fontSize:"1rem",color:"#64748b",fontWeight:600},children:"TOTAL A PAGAR"}),e.jsxs("span",{children:["C$ ",Number(n).toFixed(2)]})]}),e.jsxs(de,{style:{borderTop:"1px solid #cbd5e0",paddingTop:10,fontSize:"0.9rem",color:"#64748b"},children:[e.jsxs("span",{children:["Tasa USD: C$ ",Number(T).toFixed(2)]}),e.jsxs("span",{style:{color:"#0f172a",fontWeight:700},children:["$",(Number(n)/Number(T||1)).toFixed(2)," USD"]})]})]}),e.jsxs("div",{style:{padding:15,border:"1px solid #e2e8f0",borderRadius:12,marginBottom:15,backgroundColor:"#fff"},children:[e.jsxs(de,{style:{color:"#64748b",fontSize:"0.95rem",marginBottom:8},children:[e.jsx("span",{children:"Pagado (Contado)"}),e.jsxs("span",{style:{fontWeight:"700",color:"#1e293b"},children:["C$ ",U.toFixed(2)]})]}),e.jsxs(de,{style:{fontSize:"0.95rem"},children:[e.jsx("span",{children:"Estado"}),e.jsx("span",{style:{fontWeight:"700",color:ee>.01?"#f59e0b":z?"#22c55e":"#ef4444"},children:$e})]})]}),e.jsxs(ut,{style:{marginBottom:10,padding:15,backgroundColor:ne==="#dc3545"?"#fef2f2":ne==="#28a745"?"#ecfccb":"#e0f2fe",color:ne==="#dc3545"?"#ef4444":ne==="#28a745"?"#4d7c0f":"#0369a1",fontWeight:"800",fontSize:"1.1rem",textAlign:"center",borderRadius:12,border:"none",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsx(Ht,{style:{marginRight:8}})," ",H]})]}),e.jsxs("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs(N,{type:"button",onClick:i=>{i.preventDefault(),P(!0)},disabled:ge||!z,style:{width:"100%",padding:"16px 0",fontSize:"1.2rem",fontWeight:800,backgroundColor:ge||!z?"#cbd5e1":"#2563eb",color:"white",border:"none",borderRadius:10,boxShadow:ge||!z?"none":"0 4px 6px -1px rgba(37, 99, 235, 0.4)",transition:"all 0.2s"},children:[e.jsx(kt,{style:{marginRight:8}})," PAGAR E IMPRIMIR"]}),e.jsxs(N,{type:"button",onClick:i=>{i.preventDefault(),P(!1)},disabled:ge||!z,style:{width:"100%",padding:"12px 0",fontSize:"1rem",fontWeight:700,backgroundColor:"white",color:ge||!z?"#cbd5e1":"#475569",border:ge||!z?"1px solid #e2e8f0":"2px solid #cbd5e1",borderRadius:10,transition:"all 0.2s"},children:[e.jsx(Jt,{style:{marginRight:8}})," Solo Guardar (Sin Ticket)"]})]})]})]})]})})},Oa=Ut`
  @media print {
    body { visibility: hidden; margin: 0; padding: 0; }
    .print-area, .print-area * { visibility: visible !important; }
    .print-area {
      position: absolute !important;
      left: 0 !important;
      top: 0 !important;
      z-index: 999999 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    .no-print { display: none !important; }
    * {
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
      box-shadow: none !important;
      text-shadow: none !important;
    }
  }
`,Ma=Ee.div`
  font-family: 'Consolas','Courier New',monospace;
  color: #000;
  background: #fff;
  width: 310px;
  margin: 0 auto;
  padding: 12px 10px;
  box-shadow: 0 0 10px rgba(0,0,0,.08);
  border: 1px solid #eee;
  border-radius: 8px;

  &.compact { padding: 8px 6px; }

  /* Encabezado */
  .brand {
    text-align: center;
    border-bottom: 1px dashed #333;
    padding-bottom: 10px;
    margin-bottom: 10px;
  }
  .brand h1 { margin: 6px 0 2px; font-size: 1.35rem; font-weight: 700; color: #0b72b9; line-height: 1.25; }
  .brand small { color: #555; display: block; margin: 3px 0; line-height: 1.35; white-space: normal; word-break: break-word; }

  /* Meta */
  .meta { font-size: .9rem; margin-bottom: 12px; border-bottom: 1px dashed #ccc; padding-bottom: 8px; }
  .meta p { margin: 2px 0; display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 4px 8px; font-weight: 400; }
  .meta-label { font-weight: 700; }
  .meta-value { font-weight: 400; }

  /* Tabla */
  table.items { width: 100%; border-collapse: collapse; font-size: .9rem; table-layout: fixed; }
  table.items th, table.items td { padding: 6px 4px; vertical-align: top; word-wrap: break-word; }
  table.items th { border-bottom: 2px solid #333; font-weight: 700; text-transform: uppercase; font-size: 0.75rem; color: #1e3a8a; }
  &.compact table.items th, &.compact table.items td { padding: 4px 2px; }
  .text-right { text-align: right; }
  .col-qty { width: 15%; text-align: center; }
  .col-unit { width: 25%; text-align: right; }
  .col-total { width: 25%; text-align: right; }
  table.items td:nth-child(2) { white-space: normal; text-align: left; }

  /* Totales */
  .totals { border-top: 2px solid #333; padding-top: 6px; margin-top: 12px; }
  .badge { display: inline-block; font-weight: 700; letter-spacing: .5px; padding: 6px 10px; border: 2px solid #0b72b9; border-radius: 4px; margin: 10px auto; text-align: center; color: #0b72b9; font-size: 0.8rem; }
  .thanks { text-align: center; font-size: .85rem; border-top: 1px dashed #333; padding-top: 10px; margin-top: 12px; color: #444; line-height: 1.4; }

  /* ====== A4 SPECIFIC LAYOUT ====== */
  &.print-a4 {
    .brand { display: flex; justify-content: space-between; align-items: flex-start; text-align: left; border-bottom: 3px solid #1e3a8a; margin-bottom: 2rem; padding-bottom: 1rem; }
    .brand-logo-container { width: 150px; }
    .brand-info { text-align: right; max-width: 60%; }
    .brand h1 { font-size: 20pt; color: #1e3a8a; margin-bottom: 5px; }
    .brand small { font-size: 9pt; color: #444; margin: 1px 0; }
    
    .meta { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; border: 1px solid #ddd; padding: 15px; background: #f8fafc; border-radius: 6px; margin-bottom: 25px; }
    .meta-col { display: flex; flex-direction: column; gap: 5px; }
    .meta-title { font-weight: bold; text-transform: uppercase; color: #1e3a8a; border-bottom: 1px solid #ccc; padding-bottom: 4px; margin-bottom: 6px; font-size: 9pt; }
    .meta p { justify-content: flex-start; gap: 8px; border-bottom: none; width: 100%; display: grid; grid-template-columns: 100px 1fr; }
    
    table.items th { background: #f1f5f9; color: #334155; padding: 10px; border-bottom: 2px solid #cbd5e1; font-size: 9pt; }
    table.items td { padding: 10px; border-bottom: 1px solid #f1f5f9; font-size: 10pt; color: #334155; }
    .col-qty { width: 10%; }
    .col-unit { width: 15%; }
    .col-total { width: 15%; }
    
    .totals { border-top: none; margin-top: 0; display: flex; justify-content: flex-end; padding-top: 20px; }
    .totals-box { width: 250px; }
    
    .thanks { border-top: none; margin-top: 50px; font-style: italic; color: #94a3b8; }
  }

  @media print {
    &.print-80 {
      width: 80mm !important; font-family: 'Consolas', monospace !important; padding: 6px 4px !important; border: none !important; box-shadow: none !important; font-size: 8pt;
    }
    &.print-a4 {
      width: 190mm !important; font-size: 10pt !important; padding: 0 !important; margin: 0 !important; border: none !important; box-shadow: none !important; max-height: 277mm !important; overflow: hidden !important; font-family: 'Inter', Helvetica, Arial, sans-serif !important;
    }
    &.compact { font-size: 7.5pt; }
  }
`,Pa=Ee.div`
  display: flex; flex-direction: column; gap: 12px;
`,$a=Ee.img`
  width: 120px; max-width: 160px; height: auto; display: block; margin: 0 auto 6px; border-radius: 6px;
  &.a4-logo { margin: 0; max-width: 140px; }
`,Ba=Ee.span`
  display: inline-flex; align-items: center; gap: 6px; font-weight: 700; letter-spacing: .4px; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; background: #e8f4ff; color: #0b72b9; border: 1px solid #b9defc;
`,_a=Ee.div`
  display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid #eee; padding-bottom: .75rem;
`,Wa=({cart:n=[],total:T=0,subtotal:r=0,discount:B=0,proformaFor:M="",onClose:q,currentUser:m,client:G})=>{const{user:S}=typeof tt=="function"?tt():{user:null},{settings:w}=ja(),$=h=>(h==null?void 0:h.usuarioNombre)||(h==null?void 0:h.nombre_usuario)||(h==null?void 0:h.name)||(h==null?void 0:h.nombre)||(h==null?void 0:h.username)||null;let Q=null;try{Q=JSON.parse(localStorage.getItem("authUser")||"null")}catch{}const re=$(m)||$(S)||$(Q)||"Cajero POS",y=(G==null?void 0:G.nombre)||"Consumidor Final",c=(G==null?void 0:G.cedula)||"",x=new Date().toLocaleString("es-NI"),C=h=>new Intl.NumberFormat("es-NI",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Number(h||0)),u={name:(w==null?void 0:w.empresa_nombre)||"Multirepuestos RG",ruc:(w==null?void 0:w.empresa_ruc)||"1211812770001E",phone:(w==null?void 0:w.empresa_telefono)||"84031936 / 84058142",address:(w==null?void 0:w.empresa_direccion)||"Del portón de la normal 75 varas al este. Juigalpa, Chontales.",slogan:(w==null?void 0:w.empresa_eslogan)||"Tu mejor opción en repuestos",logo:(w==null?void 0:w.empresa_logo_url)||new URL("/icons/logo.png",window.location.origin).toString()},W=l.useCallback((h="80")=>{const V=document.getElementById("print-wrapper-proforma");if(!V)return;const ae=V.outerHTML,k=`
      @charset "UTF-8";
      @page { size: ${h==="A4"?"A4 portrait":"80mm auto"}; margin: ${h==="A4"?"12mm":"0"}; }
      html, body {
        background: #fff; margin: 0 !important; padding: 0 !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color: #000 !important; font-family: ${h==="A4"?"'Inter', Helvetica, Arial, sans-serif":"'Consolas', monospace"};
      }
      
      #print-wrapper-proforma {
        box-shadow: none !important; border: none !important; margin: 0 !important;
        ${h==="A4"?"width: 100% !important; padding: 0 !important; font-size: 10pt !important;":"width: 80mm !important; padding: 6px 4px !important; font-size: 8pt !important;"}
      }

      ${h==="A4"?`
        #print-wrapper-proforma .brand { display: flex !important; justify-content: space-between !important; align-items: flex-start !important; text-align: left !important; border-bottom: 3px solid #1e3a8a !important; margin-bottom: 25px !important; padding-bottom: 15px !important; }
        #print-wrapper-proforma .brand-logo-container { width: 140px !important; order: 1 !important; }
        #print-wrapper-proforma .brand-info { flex: 1 !important; text-align: right !important; order: 2 !important; }
        #print-wrapper-proforma .brand h1 { font-size: 22pt !important; color: #1e3a8a !important; margin: 0 0 5px 0 !important; }
        #print-wrapper-proforma .brand small { display: block !important; font-size: 9pt !important; margin: 2px 0 !important; color: #334155 !important; }
        
        #print-wrapper-proforma .meta { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 30px !important; background: #f8fafc !important; border: 1px solid #e2e8f0 !important; padding: 15px !important; margin-bottom: 30px !important; border-radius: 8px !important; }
        #print-wrapper-proforma .meta p { display: grid !important; grid-template-columns: 100px 1fr !important; width: 100% !important; border-bottom: 1px dashed #e2e8f0 !important; padding-bottom: 4px !important; margin-bottom: 4px !important; }
        #print-wrapper-proforma .meta-title { font-weight: 800 !important; text-transform: uppercase !important; color: #1e3a8a !important; border-bottom: 2px solid #cbd5e1 !important; margin-bottom: 10px !important; padding-bottom: 5px !important; display: block !important; width: 100% !important; }

        #print-wrapper-proforma table.items { width: 100% !important; border-collapse: collapse !important; border: 1px solid #e2e8f0 !important; }
        #print-wrapper-proforma table.items th { background: #f1f5f9 !important; color: #334155 !important; padding: 12px 8px !important; border-bottom: 2px solid #cbd5e1 !important; font-size: 9pt !important; text-align: left !important; }
        #print-wrapper-proforma table.items td { padding: 10px 8px !important; border-bottom: 1px solid #f1f5f9 !important; font-size: 9.5pt !important; vertical-align: top !important; }
        #print-wrapper-proforma .col-qty { text-align: center !important; }
        #print-wrapper-proforma .col-unit, #print-wrapper-proforma .col-total { text-align: right !important; }
        
        #print-wrapper-proforma .totals { display: flex !important; justify-content: flex-end !important; margin-top: 20px !important; border-top: none !important; }
        #print-wrapper-proforma .totals-box { width: 300px !important; background: #f8fafc !important; padding: 15px !important; border: 1px solid #e2e8f0 !important; border-radius: 8px !important; }
      `:`
        #print-wrapper-proforma .brand { text-align: center !important; border-bottom: 1px dashed #333 !important; }
        #print-wrapper-proforma .meta p { display: flex !important; justify-content: space-between !important; }
      `}
    `,p=window.open("","_blank","width=900,height=700");p&&(p.document.write(`<html><head><title>PROFORMA - ${u.name}</title><style>${k}</style></head><body>${ae}</body></html>`),p.document.close(),p.focus(),p.onload=function(){setTimeout(()=>{p.print()},250)})},[u]),_=n.length<=2;return e.jsxs(De,{className:"no-print",children:[e.jsx(Oa,{}),e.jsxs(Oe,{className:"no-print",style:{maxWidth:520,width:"96%",padding:"1.2rem",background:"#fff"},children:[e.jsxs(_a,{children:[e.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:8,margin:0},children:[e.jsx(Qt,{})," Vista Proforma"]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(N,{onClick:()=>W("80"),children:"Ticket 80mm"}),e.jsxs(N,{onClick:()=>W("A4"),children:[e.jsx(Je,{})," A4"]}),e.jsx(N,{$cancel:!0,onClick:q,children:e.jsx(Ze,{})})]})]}),e.jsx(Pa,{children:e.jsxs(Ma,{id:"print-wrapper-proforma",className:`print-area print-80 ${_?"compact":""}`,children:[e.jsxs("div",{className:"brand",children:[e.jsx("div",{className:"brand-logo-container",children:e.jsx($a,{className:"a4-logo",src:u.logo,alt:"Logo",onError:h=>{h.currentTarget.style.display="none"}})}),e.jsxs("div",{className:"brand-info",children:[e.jsx("h1",{children:u.name}),e.jsx("small",{children:u.slogan}),e.jsxs("small",{children:["RUC: ",u.ruc]}),e.jsxs("small",{children:["Tel: ",u.phone]}),e.jsx("small",{children:u.address}),e.jsx("div",{style:{marginTop:8},children:e.jsxs(Ba,{children:[e.jsx(Je,{})," PROFORMA"]})})]})]}),e.jsxs("div",{className:"meta",children:[e.jsxs("div",{className:"meta-col",children:[e.jsx("span",{className:"meta-title",children:"Detalles"}),e.jsxs("p",{children:[e.jsx("span",{className:"meta-label",children:"Fecha:"}),e.jsx("span",{className:"meta-value",children:x})]}),e.jsxs("p",{children:[e.jsx("span",{className:"meta-label",children:"ID Temp:"}),e.jsx("span",{className:"meta-value",children:Date.now().toString().slice(-6)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"meta-label",children:"Atendido por:"}),e.jsx("span",{className:"meta-value",children:re})]})]}),e.jsxs("div",{className:"meta-col",children:[e.jsx("span",{className:"meta-title",children:"Cliente"}),e.jsxs("p",{children:[e.jsx("span",{className:"meta-label",children:"Nombre:"}),e.jsx("span",{className:"meta-value",children:M||y})]}),c&&e.jsxs("p",{children:[e.jsx("span",{className:"meta-label",children:"Cédula:"}),e.jsx("span",{className:"meta-value",children:c})]})]})]}),e.jsxs("table",{className:"items",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"col-qty",children:"Cant."}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{className:"text-right col-unit",children:"P. Unit."}),e.jsx("th",{className:"text-right col-total",children:"Total"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",style:{textAlign:"center",color:"#777"},children:"Sin ítems"})}):n.map((h,V)=>{const ae=Number(h.precio_venta??h.precio??0),k=Number(h.quantity??0),p=ae*k;return e.jsxs("tr",{children:[e.jsx("td",{className:"col-qty",children:k}),e.jsx("td",{children:h.nombre||h.descripcion||"Item"}),e.jsxs("td",{className:"text-right col-unit",children:["C$",C(ae)]}),e.jsxs("td",{className:"text-right col-total",children:["C$",C(p)]})]},V)})})]}),e.jsx("div",{className:"totals",children:e.jsxs("div",{className:"totals-box",children:[e.jsxs(de,{children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["C$",C(r)]})]}),B>0&&e.jsxs(de,{style:{color:"#dc3545"},children:[e.jsx("span",{children:"Descuento:"}),e.jsxs("span",{children:["- C$",C(B)]})]}),e.jsxs(de,{className:"grand-total",style:{fontWeight:"bold",fontSize:"1.2rem",marginTop:5,borderTop:"2px solid black"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["C$",C(T)]})]}),e.jsxs("div",{style:{marginTop:12,textAlign:"center"},children:[e.jsx("span",{className:"badge",children:"DOCUMENTO NO VÁLIDO COMO FACTURA"}),e.jsx("p",{style:{margin:"5px 0 0",fontSize:"0.75rem",color:"#666"},children:"Precios sujetos a cambio. Válido por 3 días."})]})]})}),e.jsxs("div",{className:"thanks",children:[e.jsxs("p",{children:['"',u.slogan,'"']}),e.jsx("p",{style:{whiteSpace:"pre-line",marginTop:"5px"},children:(w==null?void 0:w.ticket_proforma_footer)||"¡Gracias por cotizar con nosotros!"})]})]})})]})]})},ze=({isOpen:n,onClose:T,onConfirm:r,onSubmit:B,title:M,message:q,fields:m=[],inputType:G="number",icon:S})=>{const[w,$]=l.useState({}),[Q,re]=l.useState("");if(l.useEffect(()=>{if(n)if(m.length>0){const x={};m.forEach(C=>{x[C.name]=C.defaultValue!==void 0?C.defaultValue:""}),$(x)}else re("")},[n,m]),!n)return null;const y=()=>{m.length>0?B?B(w):r&&r(w):B?B(Q):r&&r(Q)},c=(x,C)=>{$(u=>({...u,[x]:C}))};return e.jsx(De,{children:e.jsxs(Oe,{style:{maxWidth:"450px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[S?e.jsx("div",{style:{fontSize:"2.5rem",marginBottom:"1rem"},children:S}):e.jsx(Yt,{size:"2.5em",color:"#007bff"}),e.jsx("h2",{style:{marginTop:"0.5rem",marginBottom:"0.5rem"},children:M}),q&&e.jsx("p",{style:{color:"#6c757d"},children:q})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:m.length>0?m.map(x=>e.jsxs("div",{children:[x.label&&e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:600,fontSize:"0.9rem"},children:x.label}),x.type==="select"?e.jsx("select",{value:w[x.name],onChange:C=>c(x.name,C.target.value),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"1px solid #ccc",fontSize:"1rem"},children:x.options&&x.options.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))}):e.jsx(te,{type:x.type||"text",placeholder:x.placeholder||"",value:w[x.name],onChange:C=>c(x.name,C.target.value),autoFocus:x.name===m[0].name})]},x.name)):e.jsx(te,{type:G,value:Q,onChange:x=>re(x.target.value),autoFocus:!0})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem",marginTop:"2rem"},children:[e.jsx(N,{onClick:T,style:{backgroundColor:"#6c757d"},children:"Cancelar"}),e.jsx(N,{onClick:y,primary:!0,children:"Aceptar"})]})]})})},qe=Ee.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding: 8px;
  background: #f8f9fa;
  border-radius: 6px;
  
  label { font-weight: bold; color: #495057; }
  input { width: 120px; text-align: right; }
`,Va=({isOpen:n,onClose:T,currentStats:r,onConfirm:B})=>{const[M,q]=l.useState("manual"),[m,G]=l.useState({efectivo:"",credito:"",tarjeta:"",dolares:""}),[S,w]=l.useState({cordobas:"",dolares:""}),$=(y,c)=>{G(x=>({...x,[y]:c}))},Q=(y,c)=>{w(x=>({...x,[y]:c}))},re=()=>{const y=[];if(M==="manual")parseFloat(m.efectivo)&&y.push({target:"efectivo",amount:parseFloat(m.efectivo)}),parseFloat(m.credito)&&y.push({target:"credito",amount:parseFloat(m.credito)}),parseFloat(m.tarjeta)&&y.push({target:"tarjeta",amount:parseFloat(m.tarjeta)});else{const c=parseFloat(S.cordobas),x=parseFloat(S.dolares);if(!isNaN(c)){const C=Number((r==null?void 0:r.netCordobas)||0),u=c-C;Math.abs(u)>.01&&y.push({target:"efectivo",amount:u})}if(!isNaN(x)){const C=Number((r==null?void 0:r.netDolares)||0),u=x-C;Math.abs(u)>.01&&y.push({target:"dolares",amount:u})}}y.length>0&&B(y),T()};return n?e.jsx(De,{style:{background:"rgba(0,0,0,0.95)",zIndex:9999},children:e.jsxs(Oe,{style:{maxWidth:"450px",background:"#212529",color:"#fff",border:"1px solid #495057"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("h2",{style:{margin:0,color:"#ffc107",display:"flex",alignItems:"center",gap:10},children:[e.jsx(Kt,{})," GOD MODE"]}),e.jsx(N,{$cancel:!0,onClick:T,style:{background:"transparent",color:"#6c757d",border:"none"},children:"✕"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:20},children:[e.jsx(N,{onClick:()=>q("manual"),style:{flex:1,background:M==="manual"?"#ffc107":"#343a40",color:M==="manual"?"#000":"#fff",border:"none"},children:"Ajuste Manual (+/-)"}),e.jsx(N,{onClick:()=>q("override"),style:{flex:1,background:M==="override"?"#ffc107":"#343a40",color:M==="override"?"#000":"#fff",border:"none"},children:"Fijar Monto (=)"})]}),M==="manual"?e.jsxs(e.Fragment,{children:[e.jsx("p",{style:{color:"#adb5bd",fontSize:"0.85rem",marginBottom:15},children:"Suma o resta cantidades a los contadores ocultamente."}),e.jsxs(qe,{style:{background:"#343a40"},children:[e.jsx("label",{style:{color:"#fff"},children:"Efectivo (C$)"}),e.jsx(te,{type:"number",step:"0.01",placeholder:"+/- 0.00",value:m.efectivo,onChange:y=>$("efectivo",y.target.value),style:{background:"#495057",color:"#fff"}})]}),e.jsxs(qe,{style:{background:"#343a40"},children:[e.jsx("label",{style:{color:"#fff"},children:"Crédito"}),e.jsx(te,{type:"number",step:"0.01",placeholder:"+/- 0.00",value:m.credito,onChange:y=>$("credito",y.target.value),style:{background:"#495057",color:"#fff"}})]}),e.jsxs(qe,{style:{background:"#343a40"},children:[e.jsx("label",{style:{color:"#fff"},children:"Tarjeta"}),e.jsx(te,{type:"number",step:"0.01",placeholder:"+/- 0.00",value:m.tarjeta,onChange:y=>$("tarjeta",y.target.value),style:{background:"#495057",color:"#fff"}})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{style:{color:"#adb5bd",fontSize:"0.85rem",marginBottom:15},children:"Define EXACTAMENTE cuánto dinero físico hay. El sistema creará un ajuste mágico para cuadrar."}),e.jsxs("div",{style:{background:"#343a40",padding:10,borderRadius:6,marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.85rem",color:"#aaa",marginBottom:5},children:[e.jsx("span",{children:"Sistema Actual:"}),e.jsxs("span",{children:["C$ ",Number((r==null?void 0:r.netCordobas)||0).toFixed(2)]})]}),e.jsxs(qe,{style:{background:"transparent",padding:0,marginBottom:0},children:[e.jsx("label",{style:{color:"#fff"},children:"Real en Caja (C$)"}),e.jsx(te,{type:"number",step:"0.01",placeholder:"0.00",value:S.cordobas,onChange:y=>Q("cordobas",y.target.value),style:{background:"#495057",color:"#fff",border:"1px solid #ffc107"}})]})]}),e.jsxs("div",{style:{background:"#343a40",padding:10,borderRadius:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.85rem",color:"#aaa",marginBottom:5},children:[e.jsx("span",{children:"Sistema Actual:"}),e.jsxs("span",{children:["$ ",Number((r==null?void 0:r.netDolares)||0).toFixed(2)]})]}),e.jsxs(qe,{style:{background:"transparent",padding:0,marginBottom:0},children:[e.jsx("label",{style:{color:"#fff"},children:"Real en Caja ($)"}),e.jsx(te,{type:"number",step:"0.01",placeholder:"0.00",value:S.dolares,onChange:y=>Q("dolares",y.target.value),style:{background:"#495057",color:"#fff",border:"1px solid #ffc107"}})]})]})]}),e.jsxs("div",{style:{marginTop:25,display:"flex",gap:10},children:[e.jsx(N,{onClick:T,style:{flex:1,background:"#495057",border:"none"},children:"Cancelar"}),e.jsxs(N,{onClick:re,style:{flex:1,background:"#ffc107",color:"#000",fontWeight:"bold",border:"none"},children:[e.jsx(Xt,{style:{marginRight:6}})," ",M==="manual"?"APLICAR AJUSTE":"CUADRAR MÁGICAMENTE"]})]})]})}):null},Ae=n=>Number(n||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),Ka=()=>{var Ve,at,ot,nt,rt,it,st;const{user:n,products:T,token:r,refreshProducts:B,clients:M,allUsers:q}=tt(),{isCajaOpen:m,setIsCajaOpen:G,cajaSession:S,setCajaSession:w,tasaDolar:$,setTasaDolar:Q,closeCajaSession:re,refreshSession:y}=ya(),{orders:c,activeOrderId:x,setActiveOrderId:C,activeOrder:u,handleNewOrder:W,handleRemoveOrder:_,updateActiveOrder:h,loadOrdersFromDB:V,checkForNewOrders:ae}=Ca(),k=(n==null?void 0:n.id_usuario)||(n==null?void 0:n.id),p=n,Se=(n==null?void 0:n.rol)==="admin",[be,ue]=l.useState(T||[]),[Te,Ie]=l.useState(""),[Qe,Ue]=l.useState("description"),[Fe,z]=l.useState(!1),[A,Z]=l.useState({name:null,data:null}),[we,oe]=l.useState(null),[fe,U]=l.useState(!1),[pe,se]=l.useState({isOpen:!1,title:"",message:""}),[ee,me]=l.useState({isOpen:!1,title:"",message:"",onConfirm:null}),[L,ce]=l.useState(!1),$e=l.useRef(null),ke=l.useMemo(()=>{if(!(S!=null&&S.transactions))return{netCordobas:0,netDolares:0};let t=0,a=0;const o=S.transactions,s=Number(S.initialAmount||0);t+=s;for(const b of o){const j=(b.type||"").toLowerCase();let d=b.pagoDetalles||{};if(typeof d=="string")try{d=JSON.parse(d)}catch{d={}}let F=Number(d.ingresoCaja!==void 0?d.ingresoCaja:b.amount||0);(j==="salida"||j.includes("devolucion"))&&(F=-Math.abs(F)),j.startsWith("venta")?d.efectivo!==void 0||d.dolares!==void 0?(t+=Number(d.efectivo||0)-Number(d.cambio||0),a+=Number(d.dolares||0)):t+=F-Number(d.tarjeta||0)-Number(d.transferencia||0)-Number(d.credito||0):j.includes("abono")?d.dolares!==void 0?(a+=Number(d.dolares||0),t+=Number(d.efectivo||0)):t+=F:j==="entrada"?t+=Math.abs(F):j==="salida"?t-=Math.abs(F):j==="ajuste"?(d.target==="efectivo"&&(t+=Number(b.amount||0)),d.target==="dolares"&&(a+=Number(b.amount||0))):t+=F}return{netCordobas:t,netDolares:a}},[S]),ge=l.useCallback(()=>{try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;const a=new t,o=a.createOscillator(),s=a.createGain();o.connect(s),s.connect(a.destination),o.type="sine",o.frequency.setValueAtTime(1200,a.currentTime),s.gain.setValueAtTime(.1,a.currentTime),o.start(),o.stop(a.currentTime+.1)}catch{}},[]),D=l.useCallback(()=>{try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;const a=new t,o=a.currentTime,s=a.createOscillator(),b=a.createGain();s.connect(b),b.connect(a.destination),s.type="sine",s.frequency.setValueAtTime(523,o),b.gain.setValueAtTime(.15,o),b.gain.exponentialRampToValueAtTime(.001,o+.4),s.start(o),s.stop(o+.4);const j=a.createOscillator(),d=a.createGain();j.connect(d),d.connect(a.destination),j.type="sine",j.frequency.setValueAtTime(659,o+.12),d.gain.setValueAtTime(.001,o),d.gain.setValueAtTime(.15,o+.12),d.gain.exponentialRampToValueAtTime(.001,o+.5),j.start(o+.12),j.stop(o+.5);const F=a.createOscillator(),v=a.createGain();F.connect(v),v.connect(a.destination),F.type="sine",F.frequency.setValueAtTime(784,o+.24),v.gain.setValueAtTime(.001,o),v.gain.setValueAtTime(.18,o+.24),v.gain.exponentialRampToValueAtTime(.001,o+.7),F.start(o+.24),F.stop(o+.7)}catch{}},[]),R=(u==null?void 0:u.items)||[],je=R.reduce((t,a)=>t+a.precio_venta*a.quantity,0),Ne=((Ve=u==null?void 0:u.discount)==null?void 0:Ve.type)==="percentage"?je*u.discount.value/100:((at=u==null?void 0:u.discount)==null?void 0:at.value)||0,g=je-Ne;l.useEffect(()=>{T&&ue(T)},[T]),l.useEffect(()=>{if(k){V(k);const t=setInterval(()=>{document.hidden||ae(k)},3e3);return()=>clearInterval(t)}},[k,V,ae]);const f=({title:t,message:a})=>se({isOpen:!0,title:t,message:a}),Y=()=>se({isOpen:!1}),P=({title:t,message:a,onConfirm:o})=>{me({isOpen:!0,title:t,message:a,onConfirm:o})},ne=()=>me({isOpen:!1,title:"",message:"",onConfirm:null}),H=(t,a=null)=>Z({name:t,data:a}),i=()=>Z({name:null,data:null}),K=async()=>{try{await B(),k&&await V(k)}catch(t){console.error("Error refreshing data",t)}},X=t=>h("items",t),J=()=>{H("pinPrompt",{action:()=>ce(!0)})},Re=async t=>{for(const a of t){const o={type:"ajuste",amount:a.amount,at:new Date().toISOString(),userId:k,note:`Ajuste Interno (${a.target})`,pagoDetalles:{target:a.target,hidden:!0,amount:a.amount,efectivo:a.target==="efectivo"?a.amount:0,dolares:a.target==="dolares"?a.amount:0,credito:a.target==="credito"?a.amount:0,tarjeta:a.target==="tarjeta"?a.amount:0},id:"ADJ-"+Date.now()+"-"+Math.random().toString(36).substr(2,5)};try{await Xe({userId:k,tx:o},r)}catch(s){console.error("Error saving secret adjust:",s)}}await y(),f({title:"Procesado",message:"Ajustes aplicados correctamente."})},Me=(t,a=1)=>{window.innerWidth<=960&&z(!0);const o=t.id_producto||t.id,s=R.find(v=>(v.id_producto||v.id)===o),b=((s==null?void 0:s.quantity)||0)+a;if(b>t.existencia){f({title:"Stock Insuficiente",message:`Solo hay ${t.existencia} unidades disponibles.`});return}ge();const j=(s==null?void 0:s.precio_venta)||t.venta||t.precio||0,d={...t,id:o,id_producto:o,quantity:b,precio_venta:j},F=s?R.map(v=>(v.id_producto||v.id)===o?d:v):[...R,d];X(F)},le=(t,a)=>{var j;const o=t,s=be.find(d=>(d.id_producto||d.id)===o)||R.find(d=>(d.id_producto||d.id)===o);if(!s)return;let b=parseInt(a,10)||0;if(b<=0){X(R.filter(d=>(d.id_producto||d.id)!==o));return}b>(s.existencia||9999)&&(b=s.existencia,f({title:"Stock",message:"Cantidad máxima alcanzada según inventario."})),b>(((j=R.find(d=>(d.id_producto||d.id)===o))==null?void 0:j.quantity)||0)&&ge(),X(R.map(d=>(d.id_producto||d.id)===o?{...d,quantity:b}:d))},O=async t=>{var F;const a=x,o=c.find(v=>v.id===a);if(R.length===0)return f({title:"Carrito Vacío",message:"No hay productos para facturar."}),!1;const s=R.map(v=>({id_producto:v.id_producto||v.id,quantity:v.quantity,precio:v.precio_venta,nombre:v.nombre,codigo:v.codigo,costo:v.costo||0})),b={totalVenta:g,subtotal:je,descuento:Ne,items:s,pagoDetalles:t,userId:k,clientId:Number(t.clienteId||0),tasaDolarAlMomento:$,originalOrderId:(o==null?void 0:o.serverSaleId)||null},j=!t.shouldPrintNow,d=async()=>{var v;try{const E=await Na(b,r);B().catch(console.error);const ie=E.data||E||{},xe={...b,...ie};if(xe.id=ie.id||ie.saleId||ie._id||"N/A",xe.items=s,xe.pagoDetalles=t,xe.fecha=new Date().toISOString(),t.shouldPrintNow&&(U(!0),oe(xe)),m&&S){const ve={...t};!ve.tarjeta&&!ve.transferencia&&!ve.credito&&ve.efectivo===void 0&&(ve.efectivo=b.totalVenta);const At=((v=M.find(Ye=>Ye.id_cliente===Number(t.clienteId)))==null?void 0:v.nombre)||"Consumidor Final",Dt=Number(b.totalVenta||0);ve.efectivo=Number(ve.efectivo||0);const dt={type:"venta",amount:Dt,at:new Date().toISOString(),userId:k,note:`Venta #${xe.id} - ${At}`,pagoDetalles:ve,id:xe.id};if(Xe({userId:k,tx:dt},r).catch(console.error),!j){const Ye={...S,transactions:[dt,...S.transactions||[]]};w(Ye)}}}catch(E){console.error("CRITICAL: Error saving sale in background:",E),f({title:"⚠️ Error de Sincronización",message:`La venta por C$ ${Ae(g)} NO se guardó en el servidor.
Error: ${E.message}.

Por favor, anote los detalles o reintente.`})}};if(j){if(_(a),ue(v=>v.map(E=>{const ie=s.find(xe=>xe.id_producto===(E.id_producto||E.id));return ie?{...E,existencia:Math.max(0,E.existencia-ie.quantity)}:E})),m&&S){const v={...t},E=((F=M.find(lt=>lt.id_cliente===Number(t.clienteId)))==null?void 0:F.nombre)||"Consumidor Final",xe={type:"venta",amount:Number(b.totalVenta||0),at:new Date().toISOString(),userId:k,note:`Venta (Pendiente) - ${E}`,pagoDetalles:v,id:"PEND-"+Date.now()},ve={...S,transactions:[xe,...S.transactions||[]]};w(ve)}return D(),f({title:"¡Éxito!",message:"Venta procesada."}),d(),!0}else return await d(),_(a),ue(v=>v.map(E=>{const ie=s.find(xe=>xe.id_producto===(E.id_producto||E.id));return ie?{...E,existencia:Math.max(0,E.existencia-ie.quantity)}:E})),D(),!0},I=async(t,a,o)=>{if(!a||a<=0){f({title:"Error",message:"Ingrese un monto válido"});return}const s={type:t,amount:parseFloat(a),note:o,at:new Date().toISOString(),userId:k};try{await Xe({userId:k,tx:s},r)}catch(b){console.error("Error saving manual tx:",b),f({title:"Error Servidor",message:"No se guardó en el servidor, pero se actualizará localmente."})}await y(),i(),f({title:"Éxito",message:t==="entrada"?"Entrada registrada":"Salida registrada"})},Be=t=>{t&&t.trim()&&(h("name",t.trim()),i(),f({title:"Ticket Renombrado",message:`Nombre actualizado a: ${t.trim()} `}))},ye=t=>{var d,F;const a=(d=A.data)==null?void 0:d.item;if(!a)return;const o=parseFloat(t),s=a.costo||((F=a.raw)==null?void 0:F.costo)||0;if(o<s){f({title:"Precio Inválido",message:`El precio C$${o.toFixed(2)} es menor al costo(C$${s.toFixed(2)}).`});return}const b=a.id_producto||a.id,j=R.map(v=>(v.id_producto||v.id)===b?{...v,precio_venta:o}:v);X(j),i()},he=t=>{const a=t.id_producto||t.id,o=be.find(E=>(E.id_producto||E.id)===a)||t,s=Number(o.mayorista||o.mayoreo||0);if(!s){f({title:"Aviso",message:"Este producto no tiene precio mayorista."});return}const b=Number(t.precio_venta||0),j=Math.abs(b-s)<.01,d=Number(o.venta||o.precio||(j?t.originalPrice:t.precio_venta)||0),F=j?d:s,v=R.map(E=>(E.id_producto||E.id)===a?{...E,precio_venta:F}:E);X(v),f(j?{title:"Precio Revertido",message:"Se ha restablecido el precio regular."}:{title:"Precio Mayorista",message:"✅ ACTIVADO Precio Mayorista"})},Ce=(t,a)=>{var v,E;const o=(v=A.data)==null?void 0:v.item;if(!o)return;const s=o.id_producto||o.id;let b=o.precio_venta;const j=parseFloat(t);if(isNaN(j)||j<0){f({title:"Valor Inválido",message:"Ingrese un valor de descuento válido."});return}a==="percentage"?b=b-b*(j/100):b=b-j;const d=o.costo||((E=o.raw)==null?void 0:E.costo)||0;if(b<d){f({title:"Precio Inválido",message:`El descuento deja el precio(C$${b.toFixed(2)}) por debajo del costo.`});return}const F=R.map(ie=>(ie.id_producto||ie.id)===s?{...ie,precio_venta:b}:ie);X(F),i()},_e=l.useMemo(()=>{const t=new Map;return c.forEach(a=>{a.id!==(u==null?void 0:u.id)&&a.items.forEach(o=>{const s=o.id_producto||o.id,b=Number(o.cantidad||o.quantity||0);t.set(s,(t.get(s)||0)+b)})}),t},[c,u]),We=()=>{let t=0;const a=R.map(o=>{const s=be.find(E=>(E.id_producto||E.id)===(o.id_producto||o.id));if(!s)return o;const b=Number(s.mayorista||s.mayoreo||0);if(!b)return o;const j=Number(o.precio_venta||0),d=Math.abs(j-b)<.01,F=Number(s.venta||s.precio||o.originalPrice||o.precio_venta||0),v=d?F:b;return Math.abs(j-v)>.01?(t++,{...o,precio_venta:v}):o});if(t>0){X(a);const o=a.find((j,d)=>{var F;return Math.abs(j.precio_venta-(((F=R[d])==null?void 0:F.precio_venta)||0))>.01}),s=be.find(j=>(j.id_producto||j.id)===((o==null?void 0:o.id_producto)||(o==null?void 0:o.id))),b=s&&Math.abs(o.precio_venta-Number(s.mayorista||0))<.01;f({title:"Precio Actualizado",message:`${b?"ACTIVADO":"DESACTIVADO"} precio mayorista en ${t} producto(s).`})}else f({title:"Sin Cambios",message:"No hay productos con precio mayorista disponible o ya están aplicados."})},Ge=t=>{h("discount",t),i()};return m?e.jsxs(gt,{children:[e.jsxs(ma,{children:[e.jsxs(xa,{to:"/dashboard",children:[e.jsx(ea,{})," Regresar"]}),e.jsx("div",{style:{fontWeight:"800",letterSpacing:"1px",userSelect:"none"},onDoubleClick:J,children:"SISTEMA POS"}),e.jsxs("div",{className:"right-actions",children:[e.jsx(N,{secondary:!0,onClick:K,title:"Sincronizar",children:e.jsx(ta,{})}),e.jsx(N,{secondary:!0,onClick:()=>H("salesHistory"),title:"Historial de Ventas",children:e.jsx(aa,{})}),e.jsx(N,{secondary:!0,onClick:()=>H("cashEntry"),title:"Entrada de Dinero",children:e.jsx(oa,{color:"#10b981"})}),e.jsx(N,{secondary:!0,onClick:()=>H("cashExit"),title:"Salida de Dinero",children:e.jsx(na,{color:"#ef4444"})}),e.jsxs(N,{secondary:!0,onClick:()=>H("caja"),children:[e.jsx(Ke,{})," ",(p==null?void 0:p.nombre_usuario)||"Caja"]})]})]}),e.jsxs(fa,{children:[e.jsx(zt,{children:e.jsx(Da,{products:be,searchTerm:Te,setSearchTerm:Ie,searchType:Qe,setSearchType:Ue,onProductClick:t=>Me(t,1),cartItems:R,inputRef:$e,reservedStock:_e})}),e.jsx(ua,{isOpen:Fe,children:e.jsxs("div",{style:{padding:"1.2rem",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ra,{color:"#2563eb"})," Carrito"]}),window.innerWidth<=960&&e.jsx(N,{onClick:()=>z(!1),children:e.jsx(wt,{})})]}),e.jsxs(ga,{children:[c.map(t=>e.jsxs(N,{primary:t.id===x,secondary:t.id!==x,onClick:()=>C(t.id),onDoubleClick:()=>H("renameTicket"),style:{fontSize:"0.75rem",padding:"6px 10px",display:"flex",alignItems:"center",gap:"5px"},children:[t.name,e.jsx("span",{style:{marginLeft:5,fontWeight:"bold",cursor:"pointer"},onClick:a=>{a.stopPropagation(),_(t.id)},children:"×"})]},t.id)),e.jsx(N,{secondary:!0,onClick:W,title:"Nuevo Ticket",children:e.jsx(mt,{})})]}),e.jsxs("div",{style:{display:"flex",gap:"6px",marginTop:"0.75rem",flexWrap:"wrap"},children:[e.jsxs(N,{secondary:!0,onClick:We,title:"Cambiar a Precio Mayorista",disabled:R.length===0,style:{flex:1,fontSize:"0.75rem",padding:"8px",display:"flex",alignItems:"center",gap:"4px",justifyContent:"center"},children:[e.jsx(xt,{size:12})," Mayorista"]}),e.jsxs(N,{secondary:!0,onClick:()=>H("discount"),title:"Aplicar Descuento",disabled:R.length===0,style:{flex:1,fontSize:"0.75rem",padding:"8px",display:"flex",alignItems:"center",gap:"4px",justifyContent:"center"},children:[e.jsx(He,{size:12})," Descuento"]})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",margin:"1rem 0",paddingRight:"5px"},children:R.length===0?e.jsx("div",{style:{textAlign:"center",color:"#94a3b8",marginTop:"2rem"},children:"Selecciona productos para vender"}):R.map(t=>e.jsxs(ha,{children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.85rem",color:"#1e293b"},children:t.nombre}),e.jsx("div",{style:{fontSize:"0.85rem",fontWeight:"bold",color:"#334155",fontStyle:"normal"},children:t.codigo}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:["Unit: C$ ",Ae(t.precio_venta)]}),e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:"700",color:"#2563eb",marginTop:"2px"},children:["Total: C$ ",Ae(Number(t.quantity||1)*Number(t.precio_venta||0))]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"6px"},children:[e.jsx(Pe,{title:"Editar Precio",onClick:()=>H("editPrice",{item:t}),style:{width:26,height:26,background:"#f1f5f9",color:"#334155"},children:e.jsx(ft,{size:10})}),e.jsx(Pe,{title:"Precio Mayorista",onClick:()=>he(t),style:{width:26,height:26,background:"#f1f5f9",color:"#334155"},children:e.jsx(xt,{size:10})}),e.jsx(Pe,{title:"Descuento Item",onClick:()=>H("itemDiscount",{item:t}),style:{width:26,height:26,background:"#f1f5f9",color:"#334155"},children:e.jsx(He,{size:10})})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs(ba,{children:[e.jsx(Pe,{onClick:()=>le(t.id_producto||t.id,t.quantity-1),children:e.jsx(ia,{size:8})}),e.jsx("span",{style:{fontWeight:700,minWidth:24,textAlign:"center",fontSize:"0.9rem"},children:t.quantity}),e.jsx(Pe,{onClick:()=>le(t.id_producto||t.id,t.quantity+1),children:e.jsx(mt,{size:8})})]}),e.jsx(Pe,{onClick:()=>X(R.filter(a=>(a.id_producto||a.id)!==(t.id_producto||t.id))),style:{color:"#ef4444"},children:e.jsx(sa,{size:12})})]})]},t.id_producto||t.id))}),e.jsxs("div",{style:{borderTop:"2px solid #f1f5f9",paddingTop:"1rem"},children:[e.jsxs(de,{children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["C$ ",Ae(je)]})]}),e.jsxs(de,{style:{color:"#ef4444"},children:[e.jsx("span",{children:"Descuento"}),e.jsxs("span",{children:["- C$ ",Ae(Ne)]})]}),e.jsxs(de,{className:"grand-total",style:{fontSize:"1.4rem",marginTop:"5px"},children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{children:["C$ ",Ae(g)]})]}),e.jsxs(N,{secondary:!0,style:{width:"100%",marginTop:"1rem",padding:"10px",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"6px",justifyContent:"center"},onClick:()=>H("proformaName"),children:[e.jsx(Je,{})," Crear Proforma"]}),e.jsx(N,{primary:!0,style:{width:"100%",marginTop:"12px",padding:"16px",fontSize:"1.2rem",fontWeight:"bold"},onClick:()=>H("payment",{total:g}),disabled:R.length===0,children:"$ COBRAR (F2)"})]})]})}),e.jsxs(ht,{onClick:()=>z(!0),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{background:"#3b82f6",borderRadius:"50%",width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.8rem"},children:R.reduce((t,a)=>t+(a.quantity||0),0)}),e.jsx("span",{children:"Ver Venta"})]}),e.jsxs("span",{children:["C$ ",Ae(g)]})]})]}),e.jsxs(St,{children:[pe.isOpen&&e.jsx(De,{onClick:Y,children:e.jsxs(Oe,{onClick:t=>t.stopPropagation(),style:{maxWidth:"380px",textAlign:"center"},children:[e.jsx("h2",{style:{marginTop:0},children:pe.title}),e.jsx("p",{style:{color:"#475569"},children:pe.message}),e.jsx(N,{primary:!0,onClick:Y,style:{width:"100%",marginTop:"1rem"},children:"Entendido"})]})}),ee.isOpen&&e.jsx(De,{onClick:ne,children:e.jsxs(Oe,{onClick:t=>t.stopPropagation(),style:{maxWidth:"380px",textAlign:"center"},children:[e.jsx("h2",{style:{marginTop:0},children:ee.title}),e.jsx("p",{style:{color:"#475569"},children:ee.message}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"1rem"},children:[e.jsx(N,{onClick:ne,style:{flex:1},children:"Cancelar"}),e.jsx(N,{primary:!0,onClick:()=>{var t;(t=ee.onConfirm)==null||t.call(ee),ne()},style:{flex:1},children:"Confirmar"})]})]})}),A.name==="payment"&&e.jsx(Ra,{isOpen:!0,onClose:i,total:A.data.total,onFinishSale:O,tasaDolar:$,clientes:M||[],showAlert:f}),A.name==="caja"&&e.jsx(vt,{isOpen:!0,onClose:i,currentUser:p,isCajaOpen:m,session:S,isAdmin:Se,clients:M||[],showAlert:f,showConfirmation:P,initialTasaDolar:$,onOpenCaja:async(t,a)=>{try{const o=await jt({userId:k,openedAt:new Date().toISOString(),openedBy:{id:k,name:p==null?void 0:p.nombre_usuario},initialAmount:t,tasaDolar:a},r);await y(),i()}catch{f({title:"Error",message:"No se pudo abrir la caja en el servidor."})}},onCloseCaja:async t=>{try{await bt({userId:k,closedAt:new Date().toISOString(),closedBy:{id:k,name:p==null?void 0:p.nombre_usuario},countedAmount:t,notes:"Cierre desde POS"},r),await y(),i(),f({title:"Caja Cerrada",message:"La sesión se ha cerrado y guardado correctamente."})}catch(a){console.error(a),f({title:"Error",message:"Error cerrando caja en servidor."})}}}),A.name==="salesHistory"&&e.jsx(Ta,{isOpen:!0,onClose:i,dailySales:[],loadSales:async t=>{try{return await wa(r,t)||[]}catch(a){return console.error("Error loading sales:",a),[]}},isAdmin:Se,users:q,clients:M||[],onReprintTicket:t=>{U(!1),oe(t)},onCancelSale:async t=>{try{const a=(t==null?void 0:t.id)||t;if(await Sa(a,r),f({title:"Venta Cancelada",message:`La venta #${a} ha sido cancelada exitosamente.`}),m&&S&&typeof t=="object"){let o=typeof t.pagoDetalles=="string"?JSON.parse(t.pagoDetalles||"{}"):t.pagoDetalles||{},s=Number(o.ingresoCaja||0);!s&&o.efectivo&&(s=Number(o.efectivo));const b=o.credito>0;if(s===0&&!b&&t.totalVenta&&(s=Number(t.totalVenta)),s>0){const j={type:"cancelacion",amount:-s,at:new Date().toISOString(),userId:k,userName:(p==null?void 0:p.nombre_usuario)||"Caja",note:`Cancelación Venta #${a}`,pagoDetalles:{efectivo:s,ingresoCaja:-s},id:"CANCEL-"+Date.now()},d={...S,transactions:[j,...S.transactions||[]]};w(d),console.log("Caja actualizada por cancelación:",j)}}}catch(a){throw console.error("Cancel error:",a),f({title:"Error",message:"No se pudo cancelar la venta: "+(a.message||"Error desconocido")}),a}},onReturnItem:async(t,a,o)=>{try{const s={originalSaleId:t.id,item:a,quantity:o,userId:k};await va(s,r);const j=(a.precio||a.precio_venta||0)*o;if(m&&S){const d={type:"devolucion",amount:-j,at:new Date().toISOString(),userId:k,userName:(p==null?void 0:p.nombre_usuario)||"Caja",note:`Devolución: ${o}x ${a.nombre}`,pagoDetalles:{efectivo:-j,ingresoCaja:-j,totalVenta:-j},id:"REFUND-"+Date.now()},F={...S,transactions:[d,...S.transactions||[]]};w(F),f({title:"Devolución Exitosa",message:`Devolución registrada en sistema y C$${j.toFixed(2)} descontados de caja.`})}else f({title:"Devolución Exitosa (Caja Cerrada)",message:"Devolución registrada, pero NO se descontó de caja porque está cerrada."})}catch(s){throw console.error("Return error:",s),f({title:"Error",message:"Error al procesar devolución: "+(s.message||"Error desconocido")}),s}},onAbonoSuccess:()=>{console.log("Abono success")}}),we&&e.jsx(ka,{isOpen:!0,transaction:we,onClose:()=>{const t=fe;oe(null),U(!1),t&&f({title:"✅ ¡Venta Realizada con Éxito!",message:"El ticket se envió a imprimir correctamente."})},autoTriggerPrint:fe,showAlert:f,clients:M,users:[n],currentUser:n}),A.name==="proformaName"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Datos de Proforma",fields:[{name:"name",label:"A nombre de:",type:"text",placeholder:"Nombre del Cliente (Opcional)"}],onSubmit:t=>{i(),setTimeout(()=>H("proforma",{proformaFor:t.name}),200)},icon:e.jsx(Je,{color:"#0b72b9"})}),A.name==="proforma"&&e.jsx(Wa,{isOpen:!0,onClose:i,cart:R,total:g,subtotal:je,discount:Ne,proformaFor:(ot=A.data)==null?void 0:ot.proformaFor,currentUser:p}),A.name==="cashEntry"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Entrada de Dinero",fields:[{name:"amount",label:"Monto (C$)",type:"number",placeholder:"0.00"},{name:"note",label:"Motivo",type:"text",placeholder:"Descripción de la entrada"}],onSubmit:t=>I("entrada",t.amount,t.note),icon:e.jsx(et,{color:"#10b981"})}),A.name==="cashExit"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Salida de Dinero",fields:[{name:"amount",label:"Monto (C$)",type:"number",placeholder:"0.00"},{name:"note",label:"Motivo",type:"text",placeholder:"Descripción de la salida"}],onSubmit:t=>I("salida",t.amount,t.note),icon:e.jsx(et,{color:"#ef4444"})}),A.name==="renameTicket"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Renombrar Ticket",fields:[{name:"name",label:"Nuevo Nombre",type:"text",defaultValue:(u==null?void 0:u.name)||"Ticket"}],onSubmit:t=>Be(t.name),icon:e.jsx(la,{color:"#2563eb"})}),A.name==="editPrice"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Editar Precio",fields:[{name:"price",label:`Nuevo Precio(C$)[Costo: C$${(((rt=(nt=A.data)==null?void 0:nt.item)==null?void 0:rt.costo)||0).toFixed(2)}]`,type:"number",defaultValue:(st=(it=A.data)==null?void 0:it.item)==null?void 0:st.precio_venta}],onSubmit:t=>ye(t.price),icon:e.jsx(ft,{color:"#f59e0b"})}),A.name==="itemDiscount"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Descuento al Producto",fields:[{name:"type",label:"Tipo",type:"select",options:[{value:"fixed",label:"Monto Fijo (C$)"},{value:"percentage",label:"Porcentaje (%)"}],defaultValue:"fixed"},{name:"value",label:"Valor",type:"number",placeholder:"0.00"}],onSubmit:t=>Ce(t.value,t.type),icon:e.jsx(He,{color:"#2563eb"})}),A.name==="discount"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Aplicar Descuento",fields:[{name:"type",label:"Tipo",type:"select",options:[{value:"fixed",label:"Monto Fijo (C$)"},{value:"percentage",label:"Porcentaje (%)"}],defaultValue:"fixed"},{name:"value",label:"Valor",type:"number",placeholder:"0.00"}],onSubmit:t=>{const a={type:t.type,value:parseFloat(t.value)||0};Ge(a)},icon:e.jsx(He,{color:"#2563eb"})}),e.jsx(za,{isOpen:ee.isOpen,onClose:ne,title:ee.title,message:ee.message,onConfirm:()=>{ee.onConfirm&&ee.onConfirm(),ne()}}),A.name==="pinPrompt"&&e.jsx(ze,{isOpen:!0,onClose:i,title:"Acceso Restringido",fields:[{name:"pin",label:"PIN de Seguridad",type:"password",autoFocus:!0}],onSubmit:t=>{var a,o;t.pin==="111987"?(i(),(o=(a=A.data)==null?void 0:a.action)==null||o.call(a)):f({title:"Error",message:"PIN Incorrecto"})},icon:e.jsx(Ke,{color:"#dc3545"})}),L&&e.jsx(Va,{isOpen:!0,onClose:()=>ce(!1),session:S,currentStats:ke,onConfirm:Re})]}),e.jsxs(ht,{onClick:()=>z(!0),children:[e.jsxs("span",{children:["🛒 Carrito (",R.length,")"]}),e.jsxs("span",{style:{fontWeight:"bold"},children:["C$ ",Ae(g)]})]})]}):e.jsxs(gt,{style:{alignItems:"center",justifyContent:"center",textAlign:"center"},children:[e.jsx(Ke,{size:50,color:"#cbd5e1",style:{marginBottom:"1rem"}}),e.jsx("h1",{style:{color:"#64748b",margin:"0 0 0.5rem 0"},children:"Caja Cerrada"}),e.jsx("p",{style:{color:"#94a3b8",marginBottom:"1.5rem"},children:"Debes realizar la apertura de caja para procesar ventas."}),e.jsxs(N,{primary:!0,onClick:()=>H("caja"),children:[e.jsx(Zt,{})," Abrir Caja (F9)"]}),A.name==="caja"&&e.jsx(vt,{isOpen:!0,onClose:i,currentUser:p,isCajaOpen:m,session:S,isAdmin:Se,showAlert:f,showConfirmation:P,initialTasaDolar:$,onOpenCaja:async(t,a)=>{try{const o=await jt({userId:k,openedAt:new Date().toISOString(),openedBy:{id:k,name:(p==null?void 0:p.nombre)||(p==null?void 0:p.nombre_usuario)},initialAmount:t,tasaDolar:a},r);await y(),i()}catch{f({title:"Error",message:"No se pudo abrir la caja en el servidor."})}},onCloseCaja:async t=>{try{const a=await bt({userId:k,closedAt:new Date().toISOString(),closedBy:{id:k,name:(p==null?void 0:p.nombre)||(p==null?void 0:p.nombre_usuario)},countedAmount:t,notes:"Cierre desde POS"},r);await y(),i(),f({title:"Caja Cerrada",message:"La sesión se ha cerrado y guardado correctamente."})}catch(a){console.error(a),f({title:"Error",message:"Error cerrando caja en servidor: "+(a.message||"Desconocido")})}}})]})};export{Ka as default};
