# ==========================================================
# CONFIGURACIÓN FINAL PARA MONOREPO (CLIENT + SERVER)
# ==========================================================

[build]
# NO se usa 'base'. Todo se ejecuta desde la raíz del proyecto.
# 1. Entra a la carpeta 'client' y construye el frontend.
command = "cd client && npm install && npm run build"
# 2. La carpeta de publicación del frontend, vista desde la raíz.
publish = "client/dist"
# 3. La carpeta de funciones del backend, vista desde la raíz.
functions = "server/netlify/functions"

[context.production.environment]
# Forzamos Node.js v18 para asegurar compatibilidad.
NODE_VERSION = "18"

# --- REGLAS DE REDIRECCIÓN (SIN CAMBIOS) ---

[[redirects]]
# REGLA 1: API (Debe ir primero)
from = "/api/*"
to = "/.netlify/functions/server/:splat"
status = 200
force = true

[[redirects]]
# REGLA 2: FRONTEND (Debe ir al final)
from = "/*"
to = "/index.html"
status = 200
