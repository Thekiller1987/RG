# ==========================================================
# CONFIGURACIÓN DEFINITIVA Y A PRUEBA DE ERRORES
# ==========================================================

[build]
# Entramos a la carpeta 'client' para construir el frontend
base = "client"
command = "npm run build"
publish = "dist"

# La carpeta donde vive nuestra función del backend
functions = "server/netlify/functions"

# --- CONFIGURACIÓN DEL ENTORNO DE CONSTRUCCIÓN ---
[context.production.environment]
# ¡ESTA ES LA LÍNEA MÁS IMPORTANTE!
# Forzamos a Netlify a usar la versión 18 de Node.js para todo el proceso.
# Esto asegura compatibilidad entre frontend, backend y sus dependencias.
NODE_VERSION = "18"

# --- REGLAS DE REDIRECCIÓN ---
# Netlify las lee en orden. La primera que coincide, se aplica.

[[redirects]]
# REGLA 1: API (Debe ir primero)
# Cualquier petición a /api/... se redirige a nuestra función 'server'.
from = "/api/*"
to = "/.netlify/functions/server/:splat"
status = 200
force = true # 'force = true' es útil para asegurar que esta regla tiene prioridad

[[redirects]]
# REGLA 2: FRONTEND (Single Page Application)
# Cualquier OTRA petición que no sea /api/... debe servir el index.html
# para que React Router tome el control. ¡ESTA REGLA DEBE SER LA ÚLTIMA!
from = "/*"
to = "/index.html"
status = 200

