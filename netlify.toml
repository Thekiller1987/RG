# ==========================================================
# CONFIGURACIÓN DEFINITIVA PARA PROYECTO FULL-STACK EN NETLIFY
# Frontend: React/Vite (en la carpeta 'client')
# Backend: Node/Express (en la carpeta 'server')
# ==========================================================

[build]
# Le dice a Netlify que entre a la carpeta 'client' para construir el frontend
base = "client"
command = "npm run build"
# La carpeta final que se va a publicar (creada por 'npm run build')
publish = "dist"

# CORRECCIÓN CRÍTICA: Apuntamos a la carpeta exacta donde viven las funciones
functions = "server/netlify/functions"


# --- REGLAS DE REDIRECCIÓN (LEÍDAS EN ORDEN) ---

[[redirects]]
# REGLA 1: LA API (LA MÁS ESPECÍFICA)
# Cualquier petición que empiece con /api/ debe ir a nuestra función de backend.
# Esto tiene que ir primero para que Netlify no lo confunda con una ruta del frontend.
from = "/api/*"
to = "/.netlify/functions/server/:splat"
status = 200


[[redirects]]
# REGLA 2: EL FRONTEND (LA MÁS GENERAL)
# Cualquier otra petición que no empezó con /api/ (ej: /login, /dashboard, etc.)
# debe cargar el index.html principal. El router de React se encargará del resto.
# ¡ESTA REGLA SIEMPRE DEBE SER LA ÚLTIMA!
from = "/*"
to = "/index.html"
status = 200

